@model TFI.OCM.AziendaConsulente.CessazioniRdl

@using Newtonsoft.Json;
@{
    ViewBag.Title = "Cessazioni Rdl";
    Layout = "~/Views/Shared/_LayoutContainer.cshtml";
}

@section showMessage{
    @{Html.RenderPartial("PartialViewShowMessages");}
}

<style>
    .btn:hover {
        background-color: #0c773c
    }
    .custom-th:hover{
        cursor: pointer;
    }

</style>

<form autocomplete="off" method="post">
    <section class="content">
        <div class="container-fluid">

            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <h3 style="background:#0c773c;text-align:center;width:100%;color:white">Inserimento Cessazione Rapporto di Lavoro</h3>
                        <div class="card-body">
                            <div style="text-align:center"><label>Denuncia della cessazione del rapporto di lavoro, ai sensi dell'articolo 3 della legge 29 Novembre 1962, n°1655</label></div>
                            <div class="row" style="margin-top:3%">

                                <div class="col-4">
                                    <div class="form-group">
                                        <label>Matricola</label>
                                        <select class="form-control" id="Matricola" name="Matricola" required>
                                            <option value="" selected disabled>Seleziona</option>
                                            @if (Model != null)
                                            {
                                                foreach (var std in Model.matricolas)
                                                {
                                                    var Matricola1 = std.Matricola1 + "-" + std.ProRap;
                                                    <option value="@Matricola1">@std.Matricola1</option>
                                                }

                                            }
                                        </select>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="form-group">
                                        <label>Nome</label>

                                        <input type="text" class="form-control" id="Nome" name="Nome" placeholder="Inserire il nome" required readonly>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="form-group">
                                        <label>Cognome</label>
                                        <input type="text" class="form-control" id="Cognome" name="Cognome" placeholder="Inserire il cognome" required readonly>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-4">
                                    <div class="it-datepicker-wrapper">
                                        <label for="date1">Data Iscrizione</label>
                                        <div class="form-group">
                                            <input class="form-control it-date-datepicker" id="DataIscrizione" name="DataIscrizione" type="date" maxlength="10" placeholder="Data in formato gg/mm/aaaa" required readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="it-datepicker-wrapper">
                                        <label for="date1">Data Cessazione</label>
                                        <div class="form-group">
                                            <input class="form-control it-date-datepicker" id="DataCessazione" name="DataCessazione" type="date" maxlength="10" placeholder="Data in formato gg/mm/aaaa" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="form-group">
                                        <label>Causale Cessazione</label>
                                        <select class="form-control" id="Causale" name="Causale" required>
                                            <option value="" selected disabled>Seleziona</option>
                                            @if (Model != null)
                                            {
                                                foreach (var cas in Model.causas)
                                                {
                                                    <option value="@cas.Causale2">@cas.Causale2</option>
                                                }
                                            }
                                        </select>

                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-4">
                                    <div class="form-group">
                                        <label>IBAN</label>
                                        <input type="text" id="IBAN" name="Iban" class="form-control" placeholder="Inserire IBAN" required pattern="^(AL|al)[0-9]{2}[0-9]{8}[a-zA-Z0-9]{16}$|^(AD|ad)[0-9]{2}[0-9]{8}[a-zA-Z0-9]{12}$|^(AT|at)[0-9]{2}[0-9]{16}$|^(AZ|az)[0-9]{2}[a-zA-Z]{4}[a-zA-Z0-9]{20}$|^(BH|bh)[0-9]{2}[a-zA-Z]{4}[a-zA-Z0-9]{14}$|^(BY|by)[0-9]{2}[a-zA-Z0-9]{4}[0-9]{4}[a-zA-Z0-9]{16}$|^(BE|be)[0-9]{2}[0-9]{12}$|^(BA|ba)[0-9]{2}[0-9]{16}$|^(BR|br)[0-9]{2}[0-9]{23}[a-zA-Z][a-zA-Z0-9]$|^(BG|bg)[0-9]{2}[a-zA-Z]{4}[0-9]{6}[a-zA-Z0-9]{8}$|^(CR|cr)[0-9]{2}[0-9]{18}$|^(HR|hr)[0-9]{2}[0-9]{17}$|^(CY|cy)[0-9]{2}[0-9]{8}[a-zA-Z0-9]{16}$|^(CZ|cz)[0-9]{2}[0-9]{20}$|^(DK|dk)[0-9]{2}[0-9]{14}$|^(DO|do)[0-9]{2}[a-zA-Z]{4}[0-9]{20}$|^(TL|tl)[0-9]{2}[0-9]{19}$|^(EG|eg)[0-9]{2}[0-9]{25}$|^(SV|sv)[0-9]{2}[a-zA-Z]{4}[0-9]{20}$|^(EE|ee)[0-9]{2}[0-9]{16}$|^(FO|fo)[0-9]{2}[0-9]{14}$|^(FI|fi)[0-9]{2}[0-9]{14}$|^(FR|fr)[0-9]{2}[0-9]{10}[a-zA-Z0-9]{11}[0-9]{2}$|^(GE|ge)[0-9]{2}[a-zA-Z0-9]{2}[0-9]{16}$|^(DE|de)[0-9]{2}[0-9]{18}$|^(GI|gi)[0-9]{2}[a-zA-Z]{4}[a-zA-Z0-9]{15}$|^(GR|gr)[0-9]{2}[0-9]{7}[a-zA-Z0-9]{16}$|^(GL|gl)[0-9]{2}[0-9]{14}$|^(GT|gt)[0-9]{2}[a-zA-Z0-9]{24}$|^(HU|hu)[0-9]{2}[0-9]{24}$|^(IS|is)[0-9]{2}[0-9]{22}$|^(IQ|iq)[0-9]{2}[a-zA-Z]{4}[0-9]{15}$|^(IE|ie)[0-9]{2}[a-zA-Z0-9]{4}[0-9]{14}$|^(IL|il)[0-9]{2}[0-9]{19}$|^(IT|it)[0-9]{2}[a-zA-Z][0-9]{10}[a-zA-Z0-9]{12}$|^(JO|jo)[0-9]{2}[a-zA-Z]{4}[0-9]{22}$|^(KZ|kz)[0-9]{2}[0-9]{3}[a-zA-Z0-9]{13}$|^(XK|xk)[0-9]{2}[0-9]{16}$|^(KW|kw)[0-9]{2}[a-zA-Z]{4}[a-zA-Z0-9]{22}$|^(LV|lv)[0-9]{2}[a-zA-Z]{4}[a-zA-Z0-9]{13}$|^(LB|lb)[0-9]{2}[0-9]{4}[a-zA-Z0-9]{20}$|^(LY|ly)[0-9]{2}[0-9]{21}$|^(LI|li)[0-9]{2}[0-9]{5}[a-zA-Z0-9]{12}$|^(LT|lt)[0-9]{2}[0-9]{16}$|^(LU|lu)[0-9]{2}[0-9]{3}[a-zA-Z0-9]{13}$|^(MK|mk)[0-9]{2}[0-9]{3}[a-zA-Z0-9]{10}[0-9]{2}$|^(MT|mt)[0-9]{2}[a-zA-Z]{4}[0-9]{5}[a-zA-Z0-9]{18}$|^(MR|mr)[0-9]{2}[0-9]{23}$|^(MU|mu)[0-9]{2}[a-zA-Z]{4}[0-9]{19}[a-zA-Z]{3}$|^(MC|mc)[0-9]{2}[0-9]{10}[a-zA-Z0-9]{11}[0-9]{2}$|^(MD|md)[0-9]{2}[a-zA-Z0-9]{20}$|^(ME|me)[0-9]{2}[0-9]{18}$|^(NL|nl)[0-9]{2}[a-zA-Z]{4}[0-9]{10}$|^(NO|no)[0-9]{2}[0-9]{11}$|^(PK|pk)[0-9]{2}[a-zA-Z0-9]{4}[0-9]{16}$|^(PS|ps)[0-9]{2}[a-zA-Z0-9]{4}[0-9]{21}$|^(PL|pl)[0-9]{2}[0-9]{24}$|^(PT|pt)[0-9]{2}[0-9]{21}$|^(QA|qa)[0-9]{2}[a-zA-Z]{4}[a-zA-Z0-9]{21}$|^(RO|ro)[0-9]{2}[a-zA-Z]{4}[a-zA-Z0-9]{16}$|^(LC|lc)[0-9]{2}[a-zA-Z]{4}[a-zA-Z0-9]{24}$|^(SM|sm)[0-9]{2}[a-zA-Z][0-9]{10}[a-zA-Z0-9]{12}$|^(ST|st)[0-9]{2}[0-9]{21}$|^(SA|sa)[0-9]{2}[0-9]{2}[a-zA-Z0-9]{18}$|^(RS|rs)[0-9]{2}[0-9]{18}$|^(SC|sc)[0-9]{2}[a-zA-Z]{4}[0-9]{20}[a-zA-Z]{3}$|^(SK|sk)[0-9]{2}[0-9]{20}$|^(SI|si)[0-9]{2}[0-9]{15}$|^(ES|es)[0-9]{2}[0-9]{20}$|^(SD|sd)[0-9]{2}[0-9]{14}$|^(SE|se)[0-9]{2}[0-9]{20}$|^(CH|ch)[0-9]{2}[0-9]{5}[a-zA-Z0-9]{12}$|^(TN|tn)[0-9]{2}[0-9]{20}$|^(TR|tr)[0-9]{2}[0-9]{5}[a-zA-Z0-9]{17}$|^(UA|ua)[0-9]{2}[0-9]{6}[a-zA-Z0-9]{19}$|^(AE|ae)[0-9]{2}[0-9]{19}$|^(GB|gb)[0-9]{2}[a-zA-Z]{4}[0-9]{14}$|^(VA|va)[0-9]{2}[0-9]{18}$|^(VG|vg)[0-9]{2}[a-zA-Z0-9]{4}[0-9]{16}$" title="inserire un iban valido">
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="form-group">
                                        <label>BIC/SWIFT</label>
                                        <input type="text" id="BIC" name="BIC" class="form-control" placeholder="Inserire BIC/SWIFT">
                                        <p>(Solo per bonifici esteri)</p>
                                    </div>
                                </div>
                            </div>                           

                                <div class="row">
                                    <div class="col-4">
                                        <div class="form-group">
                                            <label>Giorni preavviso</label>
                                            <input type="number" id="GiorniPreavviso" name="Giorni" class="form-control" placeholder="Inserire giorni di preavviso" min="0" maxlength="11">
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="form-group">
                                            <label>Importo preavviso</label>
                                            <input type="number" id="ImportiPreavviso" name="Importi" class="form-control" placeholder="Inserire importi" min="0" maxlength="14">
                                        </div>
                                    </div>
                                </div>
                            
                            <div class="row justify-content-lg-end " style="margin-top:2%">
                                <div class="col-sm-2 justify-content-end">
                                    <button type="submit" id="btnSalva" class="btn btn-block btn-outline-success btn-lg">Salva</button>
                                </div>
                                <div class="col-sm-2 justify-content-end">
                                    <button type="reset" id="btnAnnulla" class="btn btn-block btn-outline-success btn-lg">Annulla</button>
                                </div>
                            </div>
                        </div>


                    </div>
                </div>

            </div>
        </div>
    </section>
</form>
<br />
<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div style="background-color:#0c773c;color:white;text-align:center;font-size:25px" class="card-header">Elenco Rapporti di Lavoro cessati</div>

                    <div class="card-body" style="overflow:auto;max-height:50vh">
                        <table id="example2" class="table table-bordered table-hover table-striped table-responsive">
                            <thead>
                                <tr>
                                    <th class="custom-th" id="th_Matricola2" style="background:#0c773c;color:white;width:20%;text-align:center;vertical-align:middle" onclick="sortMe('Matricola2')">Matricola</th>
                                    <th class="custom-th" id="th_Cognome" style="background:#0c773c;color:white;width:20%;text-align:center;vertical-align:middle" onclick="sortMe('Cognome')">Cognome</th>
                                    <th class="custom-th" id="th_Nome" style="background:#0c773c;color:white;width:20%;text-align:center;vertical-align:middle" onclick="sortMe('Nome')">Nome</th>
                                    <th class="custom-th" id="th_DataIscrizione" style="background:#0c773c;color:white;width:20%;text-align:center;vertical-align:middle" onclick="sortMe('DataIscrizione')">Data Decorrenza</th>
                                    <th class="custom-th" id="th_DataCessazione" style="background:#0c773c;color:white;width:20%;text-align:center;vertical-align:middle" onclick="sortMe('DataCessazione')">Data Cessazione <i class="fa fa-arrow-down"></i></th>
                                    <th class="custom-th" id="th_Causale1" style="background:#0c773c;color:white;width:20%;text-align:center;vertical-align:middle" onclick="sortMe('Causale1')">Causale</th>
                                    <th style="background:#0c773c;color:white;width:20%;text-align:center;vertical-align:middle">Ricevuta</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody">
                                
                            </tbody>
                        </table>
                    </div>

                    @if (Model.listas.Count == 0)
                    {


                        <h4 class="text-center">
                            NON SONO STATI TROVATI RAPPORTI DI LAVORO CESSATI
                        </h4>
                    }
                    else
                    {
                        <div class="row d-flex justify-content-end w-100 align-items-center">
                            <div>
                                <select id="pageSize" class="page-link page-number m-3" aria-label="Default select example" onchange="changePageSize(event)">
                                    <option value="10" selected>10</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                </select>

                            </div>
                            <div>
                                <nav class="m-3" aria-label="Page navigation example">
                                    <ul class="pagination">
                                        <li class="page-item"><button class="page-link" value="" onclick="goToPage(-1, true)"><<</button></li>
                                        <li class="page-item"><button class="page-link" value="" onclick="goToPage(-1)"><</button></li>
                                        <li class="page-item"><button class="page-link" value="" onclick="goToPage(1)">></button></li>
                                        <li class="page-item"><button class="page-link" value="" onclick="goToPage(1, true)">>></button></li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                        <div class="row d-flex justify-content-end w-100 align-items-center">
                            <div id="pageCount">
                                0/0
                            </div>
                        </div>
                    }

                    <!-- /.card-body -->
                </div>
            </div>
        </div>
    </div>
</section>

@section JS{

    <script>

        let pageSize = 10;
        let currentPage = 1;
        let elements = @Html.Raw(JsonConvert.SerializeObject(Model.listas));
        let elementCount = elements.length;
        let isAsc = true;
        let prevSortingState = "DataCessazione";

        function changePageSize(event) {
            pageSize = +event.target.value;
            currentPage = 1;
            changePage(elements);
        };

        function changePageCount() {
            let maxPages = Math.ceil(elementCount / pageSize);
            document.getElementById("pageCount").innerHTML = currentPage + "/" + maxPages;
        };

        function buildTable(listToShow) {
            let content = "";
            for (let i = 0; i < listToShow.length; i++) {
                let nomeFile = listToShow[i].NomeFile != "#" ? `/AziendaConsulente/FTP_DownloadFile/${listToShow[i].NomeFile}` : "#";
                content += ('<tr>' +
                    `<td style="text-align:center">${listToShow[i].Matricola2}</td>` +
                    `<td style="text-align:center">${listToShow[i].Cognome}</td>` +
                    `<td style="text-align:center">${listToShow[i].Nome}</td>` +
                    `<td style="text-align:center">${new Date(listToShow[i].DataIscrizione).toLocaleDateString(undefined, { dateStyle: 'short' })}</td>` +
                    `<td style="text-align:center">${new Date(listToShow[i].DataCessazione).toLocaleDateString(undefined, { dateStyle: 'short' })}</td>` +
                    `<td style="text-align:center">${listToShow[i].Causale1}</td>` +
                    `<td style="text-align:center"><a class="linkRicevCess" alert="${nomeFile}" href="${nomeFile}"><img src="/Images/pdf-icon-png-adobe-acrobat.png"/></a></td></tr>`);
            }
            document.getElementById("tableBody").innerHTML = content;
        };

        function changePage(list) {
            buildTable(list.slice((currentPage - 1) * pageSize, (currentPage - 1) * pageSize + pageSize));
            changePageCount();
        }

        function isPageChangeable(nextPage) {
            let maxPages = Math.ceil(elementCount / pageSize);
            if (nextPage > 0 && nextPage <= maxPages)
                currentPage = nextPage;

            if (nextPage < 0)
                currentPage = 1;

            if (nextPage > maxPages)
                currentPage = maxPages;

            changePage(elements);
        }

        function goToPage(pageChange, isBulk = false) {
            if (isBulk) {
                let nextPage = currentPage + pageSize * pageChange;
                isPageChangeable(nextPage);
            }
            else {
                let nextPage = currentPage + pageChange;
                isPageChangeable(nextPage);
            }
        }

        function changeAsc(colonna) {
            if (colonna == prevSortingState)
                isAsc = !isAsc;
            else
                isAsc = true;
        }

        function sortElements(list, colonna) {
            list.sort(
                (a, b) => isAsc ? a[colonna].localeCompare(b[colonna]) : a[colonna].localeCompare(b[colonna]) * -1
            );

            return list;
        }

        function sortMe(colonna) {
            changeAsc(colonna);
            let sortedElements = sortElements(elements, colonna);
            changePage(sortedElements);

            let prevTh = document.getElementById(`th_${prevSortingState}`);
            let currTh = document.getElementById(`th_${colonna}`);

            let indexOfIcon = prevTh.innerHTML.indexOf("<");
            prevTh.innerHTML = prevTh.innerHTML.substring(0, indexOfIcon - 1);

            currTh.innerHTML += ` <i class="fa fa-arrow-${isAsc ? "up" : "down"}"></i>`;

            prevSortingState = colonna;
        }

        $(document).ready(function () {
            changePage(elements);

            $("#Matricola").change(function () {
                svuotaCampiCessazioneRdl();
                var matricola = $(this).val();

                $.ajax({
                    url: '/AziendaConsulente/GetDatiAnagraficiIscritto',
                    dataType: 'json',
                    method: 'POST',
                    data: { 'matricola': matricola },
                    success: function (result) {
                        if (result != "") {
                            var anagraficaIscritto = JSON.parse(result);
                            $("#Nome").val(anagraficaIscritto.Nome.trim());
                            $("#Cognome").val(anagraficaIscritto.Cognome.trim());
                            $("#DataIscrizione").val(anagraficaIscritto.DataIscrizione);
                            $("#IBAN").val(anagraficaIscritto.Iban);
                        }
                    }
                });
            });

            $(".linkRicevCess").click(function () {
                var path = $(this).attr("alert");
                if (path == "#") {
                    alert("File non disponibile");
                }

            });

            function svuotaCampiCessazioneRdl() {
                $("#DataCessazione").val('');
                $("#Causale").val('');
                $("#IBAN").val('');
                $("#BIC").val('');
                $("#GiorniPreavviso").val('');
                $("#ImportiPreavviso").val('');
            }


        });

        $('#IBAN').on("blur",
            () => {
                var validityIban = CheckIban();
                if (!validityIban) {
                    document.getElementById("IBAN").setCustomValidity("Iban non valido");
                } else
                    document.getElementById("IBAN").setCustomValidity("");
            });

        function CheckIban() {
            var ibanValue = $("#IBAN").val().replace(" ", "").toUpperCase();
            if (!ibanValue.match(/^(AL|al)[0-9]{2}[0-9]{8}[a-zA-Z0-9]{16}$|^(AD|ad)[0-9]{2}[0-9]{8}[a-zA-Z0-9]{12}$|^(AT|at)[0-9]{2}[0-9]{16}$|^(AZ|az)[0-9]{2}[a-zA-Z]{4}[a-zA-Z0-9]{20}$|^(BH|bh)[0-9]{2}[a-zA-Z]{4}[a-zA-Z0-9]{14}$|^(BY|by)[0-9]{2}[a-zA-Z0-9]{4}[0-9]{4}[a-zA-Z0-9]{16}$|^(BE|be)[0-9]{2}[0-9]{12}$|^(BA|ba)[0-9]{2}[0-9]{16}$|^(BR|br)[0-9]{2}[0-9]{23}[a-zA-Z][a-zA-Z0-9]$|^(BG|bg)[0-9]{2}[a-zA-Z]{4}[0-9]{6}[a-zA-Z0-9]{8}$|^(CR|cr)[0-9]{2}[0-9]{18}$|^(HR|hr)[0-9]{2}[0-9]{17}$|^(CY|cy)[0-9]{2}[0-9]{8}[a-zA-Z0-9]{16}$|^(CZ|cz)[0-9]{2}[0-9]{20}$|^(DK|dk)[0-9]{2}[0-9]{14}$|^(DO|do)[0-9]{2}[a-zA-Z]{4}[0-9]{20}$|^(TL|tl)[0-9]{2}[0-9]{19}$|^(EG|eg)[0-9]{2}[0-9]{25}$|^(SV|sv)[0-9]{2}[a-zA-Z]{4}[0-9]{20}$|^(EE|ee)[0-9]{2}[0-9]{16}$|^(FO|fo)[0-9]{2}[0-9]{14}$|^(FI|fi)[0-9]{2}[0-9]{14}$|^(FR|fr)[0-9]{2}[0-9]{10}[a-zA-Z0-9]{11}[0-9]{2}$|^(GE|ge)[0-9]{2}[a-zA-Z0-9]{2}[0-9]{16}$|^(DE|de)[0-9]{2}[0-9]{18}$|^(GI|gi)[0-9]{2}[a-zA-Z]{4}[a-zA-Z0-9]{15}$|^(GR|gr)[0-9]{2}[0-9]{7}[a-zA-Z0-9]{16}$|^(GL|gl)[0-9]{2}[0-9]{14}$|^(GT|gt)[0-9]{2}[a-zA-Z0-9]{24}$|^(HU|hu)[0-9]{2}[0-9]{24}$|^(IS|is)[0-9]{2}[0-9]{22}$|^(IQ|iq)[0-9]{2}[a-zA-Z]{4}[0-9]{15}$|^(IE|ie)[0-9]{2}[a-zA-Z0-9]{4}[0-9]{14}$|^(IL|il)[0-9]{2}[0-9]{19}$|^(IT|it)[0-9]{2}[a-zA-Z][0-9]{10}[a-zA-Z0-9]{12}$|^(JO|jo)[0-9]{2}[a-zA-Z]{4}[0-9]{22}$|^(KZ|kz)[0-9]{2}[0-9]{3}[a-zA-Z0-9]{13}$|^(XK|xk)[0-9]{2}[0-9]{16}$|^(KW|kw)[0-9]{2}[a-zA-Z]{4}[a-zA-Z0-9]{22}$|^(LV|lv)[0-9]{2}[a-zA-Z]{4}[a-zA-Z0-9]{13}$|^(LB|lb)[0-9]{2}[0-9]{4}[a-zA-Z0-9]{20}$|^(LY|ly)[0-9]{2}[0-9]{21}$|^(LI|li)[0-9]{2}[0-9]{5}[a-zA-Z0-9]{12}$|^(LT|lt)[0-9]{2}[0-9]{16}$|^(LU|lu)[0-9]{2}[0-9]{3}[a-zA-Z0-9]{13}$|^(MK|mk)[0-9]{2}[0-9]{3}[a-zA-Z0-9]{10}[0-9]{2}$|^(MT|mt)[0-9]{2}[a-zA-Z]{4}[0-9]{5}[a-zA-Z0-9]{18}$|^(MR|mr)[0-9]{2}[0-9]{23}$|^(MU|mu)[0-9]{2}[a-zA-Z]{4}[0-9]{19}[a-zA-Z]{3}$|^(MC|mc)[0-9]{2}[0-9]{10}[a-zA-Z0-9]{11}[0-9]{2}$|^(MD|md)[0-9]{2}[a-zA-Z0-9]{20}$|^(ME|me)[0-9]{2}[0-9]{18}$|^(NL|nl)[0-9]{2}[a-zA-Z]{4}[0-9]{10}$|^(NO|no)[0-9]{2}[0-9]{11}$|^(PK|pk)[0-9]{2}[a-zA-Z0-9]{4}[0-9]{16}$|^(PS|ps)[0-9]{2}[a-zA-Z0-9]{4}[0-9]{21}$|^(PL|pl)[0-9]{2}[0-9]{24}$|^(PT|pt)[0-9]{2}[0-9]{21}$|^(QA|qa)[0-9]{2}[a-zA-Z]{4}[a-zA-Z0-9]{21}$|^(RO|ro)[0-9]{2}[a-zA-Z]{4}[a-zA-Z0-9]{16}$|^(LC|lc)[0-9]{2}[a-zA-Z]{4}[a-zA-Z0-9]{24}$|^(SM|sm)[0-9]{2}[a-zA-Z][0-9]{10}[a-zA-Z0-9]{12}$|^(ST|st)[0-9]{2}[0-9]{21}$|^(SA|sa)[0-9]{2}[0-9]{2}[a-zA-Z0-9]{18}$|^(RS|rs)[0-9]{2}[0-9]{18}$|^(SC|sc)[0-9]{2}[a-zA-Z]{4}[0-9]{20}[a-zA-Z]{3}$|^(SK|sk)[0-9]{2}[0-9]{20}$|^(SI|si)[0-9]{2}[0-9]{15}$|^(ES|es)[0-9]{2}[0-9]{20}$|^(SD|sd)[0-9]{2}[0-9]{14}$|^(SE|se)[0-9]{2}[0-9]{20}$|^(CH|ch)[0-9]{2}[0-9]{5}[a-zA-Z0-9]{12}$|^(TN|tn)[0-9]{2}[0-9]{20}$|^(TR|tr)[0-9]{2}[0-9]{5}[a-zA-Z0-9]{17}$|^(UA|ua)[0-9]{2}[0-9]{6}[a-zA-Z0-9]{19}$|^(AE|ae)[0-9]{2}[0-9]{19}$|^(GB|gb)[0-9]{2}[a-zA-Z]{4}[0-9]{14}$|^(VA|va)[0-9]{2}[0-9]{18}$|^(VG|vg)[0-9]{2}[a-zA-Z0-9]{4}[0-9]{16}$/))
                return false;
            var ibanToCheck = ibanValue.substring(4) + ibanValue.substring(0, 4);
            var num = 0;
            for (var i = 0; i < ibanToCheck.length; i++) {
                num = !ibanToCheck.charAt(i).match(/[A-Z]/) ? (10 * num + (ibanToCheck.charAt(i).charCodeAt(0) - 48)) % 97 : (100 * num + (ibanToCheck.charAt(i).charCodeAt(0) - 55)) % 97;
            }
            return num === 1;
        }

        $(document).ready(function () {
            if (($('#IBAN')[0].defaultValue[0] + $('#IBAN')[0].defaultValue[1]) != "IT") {
                document.getElementById("BIC").setAttribute("required", true);
            } else {
                document.getElementById("BIC").removeAttribute("required");
            }
        });

        $('#IBAN').change(function () {
            if ((this.value[0] + this.value[1]) != "IT") {
                document.getElementById("BIC").setAttribute("required", true);
            } else {
                document.getElementById("BIC").removeAttribute("required");
            }
        });

    </script>

}