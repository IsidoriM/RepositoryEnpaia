
@model TFI.OCM.AziendaConsulente.RapportiLavoro

@using Newtonsoft.Json;
@{
    var modIsc = Model.modIsc;
}
@{
    ViewBag.Title = "Nuovo Rapporto di Lavoro";
    Layout = "~/Views/Shared/_LayoutContainer.cshtml";
}
@section showMessage{
    @{Html.RenderPartial("PartialViewShowMessages");}

}
<style>
    .table td {
        text-align: center;
        vertical-align: middle;
    }

    .table th {
        background: #0c773c;
        color: white;
        width: fit-content;
        text-align: center;
    }

    .btn-outline-success:hover {
        background-color: #0c773c
    }

    .spazioCheckMesi > input {
        margin-left: 8px;
    }
</style>


<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                @using (Html.BeginForm("ModRapportiLavoro", "AziendaConsulente"))
                {

                    <div class="card">
                        <div class="card-header" style="background: #0c773c;text-align: center;width: 100%;color: white;font-size: 25px">
                            Inserimento Nuovo Rapporto di Lavoro
                        </div>
                        <div class="card-body">

                            <div class="row">
                                <div class="col-sm-2">
                                    <div class="form-group">
                                        <label>Posizione</label>
                                        <input type="text" class="form-control" value="@Model.posizione" id="codPos" disabled>

                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <label>Ragione sociale</label>
                                        <input type="text" class="form-control" value="@Model.ragioneSociale" disabled>
                                    </div>
                                </div>
                                <div class="col-sm-3">
                                    <div class="form-group">
                                        <label>Codice Fiscale</label>
                                        <input type="text" id="codiceFiscale" name="codiceFiscale" class="form-control" maxlength="16">
                                    </div>
                                </div>
                                <div class="col-sm-3">
                                    <div class="form-group">
                                        <label>&emsp;</label>
                                        <input type="button" onclick="CercaIscritto()" value="Cerca Iscritto" class=" btn btn-block btn-outline-success">
                                    </div>
                                </div>
                            </div>





                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="card card-primary card-tabs">
                                        <div class="card-header p-0 pt-1" style="background-color: #0c773c;color:white">
                                            <ul class="nav nav-tabs" id="custom-tabs-one-tab" role="tablist">
                                                <li class="nav-item col-sm-3">
                                                    <a class="nav-link active" id="custom-tabs-one-home-tab" href="#custom-tabs-one-home" role="tab" aria-controls="custom-tabs-one-home" aria-selected="true">Dati Anagrafici</a>
                                                </li>
                                                <li class="nav-item col-sm-3">
                                                    <a class="nav-link" id="custom-tabs-one-profile-tab" href="#custom-tabs-one-profile" role="tab" aria-controls="custom-tabs-one-profile" aria-selected="false">Dati Contrattuali</a>
                                                </li>
                                                <li class="nav-item col-sm-3">
                                                    <a class="nav-link" id="custom-tabs-one-messages-tab" href="#custom-tabs-one-messages" role="tab" aria-controls="custom-tabs-one-messages" aria-selected="false">Dati Retributivi</a>
                                                </li>
                                                @if ((bool)TempData["isAziSomm"])
                                                {
                                                    <li class="nav-item col-sm-3">
                                                        <a class="nav-link" id="custom-tabs-one-settings-tab" href="#custom-tabs-one-settings" role="tab" aria-controls="custom-tabs-one-settings" aria-selected="false">Azienda utilizzatrice</a>
                                                    </li>
                                                }
                                            </ul>
                                        </div>
                                        <div class="card-body">

                                            <div class="tab-content" id="custom-tabs-one-tabContent">
                                                <div class="tab-pane fade show active" id="custom-tabs-one-home" role="tabpanel" aria-labelledby="custom-tabs-one-home-tab">
                                                    <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-sm-2">
                                                            <div class="form-group">
                                                                <label>Matricola</label>
                                                                <input type="text" class="form-control" id="matricola" name="matricola" readonly>
                                                                <input type="text" class="form-control" id="checkIscritto" asp-for="checkIscritto" name="checkIscritto" value="1" hidden>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-5">
                                                            <div class="form-group">
                                                                <label>Cognome</label>
                                                                <input type="text" asp-for="cognome" name="cognome" class="form-control" value="" placeholder="Inserire Cognome" id="cognome" onchange="checkAndCompilaFromCodFis()" required maxlength="80">
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-5">
                                                            <div class="form-group">
                                                                <label>Nome</label>
                                                                <input type="text" class="form-control" asp-for="nome" name="nome" value="" placeholder="Inserire Nome" id="nome" onchange="checkAndCompilaFromCodFis()" required maxlength="40">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-6">
                                                            <div class="form-group">
                                                                <label>Codice Fiscale</label>
                                                                <input type="text" value="" id="codFis" asp-for="codFis" name="codFis" class="form-control" placeholder="Inserire Codice Fiscale" onchange="checkAndCompilaFromCodFis()" maxlength="16" required pattern="^[a-zA-Z]{6}[0-9]{2}[a-zA-Z][0-9]{2}[a-zA-Z][0-9]{3}[a-zA-Z]$">
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-4">
                                                            <div class="form-group">
                                                                <label>Data Nascita</label>
                                                                <input type="date" id="dataNas" asp-for="dataNas" name="dataNas" class="form-control" placeholder="Data Nascita" style="pointer-events: none;background: #E9ECEF" required />
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-2">
                                                            <div class="form-group">
                                                                <label>Genere</label>
                                                                <select class="form-control" value="" id="sesso" asp-for="sesso" name="sesso" style="pointer-events: none;background: #E9ECEF" required>
                                                                    <option value=""></option>
                                                                    @foreach (var std in ViewBag.ListaGeneri)
                                                                    {
                                                                        <option value="@std.Id">@std.Descrizione</option>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-6">
                                                            <div class="form-group">
                                                                <label>Comune di Nascita</label>
                                                                <select id="comuneN" asp-for="comuneN" name="comuneNCod" class="form-control" style="pointer-events: none;background: #E9ECEF" required>
                                                                    <option value=""></option>
                                                                    @foreach (var std in ViewBag.ListaComuni)
                                                                    {
                                                                        <option value="@std.CODCOM">@std.DENCOM</option>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-2">
                                                            <div class="form-group">
                                                                <label>Provincia di Nascita</label>
                                                                <select id="provinciaN" asp-for="provinciaN" name="provinciaN" class="form-control" style="pointer-events: none;background: #E9ECEF" required>
                                                                    <option value=""></option>
                                                                    @foreach (var std in ViewBag.ListaProvince)
                                                                    {
                                                                        <option value="@std.SIGPRO">@std.DENPRO</option>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-4">
                                                            <div class="form-group">
                                                                <label>Stato Estero</label>
                                                                <select id="statoEsN" asp-for="statoEsN" name="statoEsN" class="form-control" style="pointer-events: none;background: #E9ECEF">
                                                                    <option value=""></option>
                                                                    @foreach (var se in ViewBag.ListaStatiEsteri)
                                                                    {
                                                                        <option value="@se.CODCOMSE">@se.DENCOMSE</option>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <hr />
                                                    <div class="row">
                                                        <div class="col-sm-3">
                                                            <div class="form-group autocomplete">
                                                                <label>Titolo di Studio</label>
                                                                <select class="form-control" id="titoloStudio" name="titoloStudio" asp-for="titoloStudio" required>
                                                                    <option value=""></option>
                                                                    @foreach (var item in Model.listNIStudio)
                                                                    {
                                                                        <option value="@item.titoloStudioCod">@item.titoloStudio</option>
                                                                    }

                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-2">
                                                            <div class="form-group">
                                                                <label>DUG</label>
                                                                <select class="form-control" id="indirizzo" name="indirizzo" asp-for="indirizzo" required>
                                                                    <option value=""></option>
                                                                    @foreach (var item in Model.listNIVia)
                                                                    {
                                                                        <option value="@item.indirizzoCod">@item.indirizzo</option>
                                                                    }

                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-5">
                                                            <div class="form-group">
                                                                <label>Indirizzo di Residenza</label>
                                                                <input type="text" value="" class="form-control" id="residenza" asp-for="residenza" name="residenza" placeholder="Inserire indirizzo" maxlength="80" required>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-2">
                                                            <div class="form-group">
                                                                <label>Civico</label>
                                                                <input type="text" value="" class="form-control" id="civico" asp-for="civico" name="civico" placeholder="Inserire civico" maxlength="10" required pattern="^(^\d+(\/[a-zA-Z])?[a-zA-Z]?$)|(SNC)$">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-2">
                                                            <div class="form-group">
                                                                <label>Provincia</label>
                                                                <select class="form-control" id="provincia" asp-for="provincia" name="provincia" placeholder="Inserire la Provincia" required>
                                                                    <option value="">Selezionare Provincia</option>
                                                                    @foreach (var std in ViewBag.ListaProvince)
                                                                    {
                                                                        if (std.SIGPRO != "EE")
                                                                        {
                                                                            <option value="@std.SIGPRO">@std.SIGPRO</option>
                                                                        }
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-4">
                                                            <div class="form-group">
                                                                <label>Comune</label>
                                                                <select class="form-control" id="comune" asp-for="comune" name="comuneCod" placeholder="Inserire Comune" style="pointer-events: none;background: #E9ECEF" required>
                                                                    <option value=""></option>
                                                                    @foreach (var std in ViewBag.ListaComuni)
                                                                    {
                                                                        <option value="@std.CODCOM" @(Model.modIsc.comune == std.DENCOM ? "selected" : "")>@std.DENCOM</option>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-4">
                                                            <div class="form-group">
                                                                <label>Località</label>
                                                                <select class="form-control" id="localita" asp-for="localita" name="localita" placeholder="" style="pointer-events: none;background: #E9ECEF" required>
                                                                    <option value=""></option>
                                                                    @foreach (var loc in ViewBag.ListaLocalita)
                                                                    {
                                                                        <option value="@loc.DENLOC" @(Model.modIsc.localita == loc.DENLOC ? "selected" : "")>@loc.DENLOC</option>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-2">
                                                            <div class="form-group">
                                                                <label>Cap</label>
                                                                <input type="text" value="" class="form-control" pattern=".{5}" id="cap" asp-for="cap" name="cap" required readonly maxlength="9">
                                                            </div>
                                                        </div>

                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-6">
                                                            <div class="form-group">
                                                                <label>Stato Estero</label>
                                                                <select class="form-control" id="statoEs" asp-for="statoEs" name="statoEs" placeholder="Inserire lo Stato Estero">
                                                                    <option value="">Selezionare Stato Estero</option>
                                                                    @foreach (var se in ViewBag.ListaStatiEsteri)
                                                                    {
                                                                        <option value="@se.CODCOMSE">@se.DENCOMSE</option>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-6">
                                                            <div class="form-group">
                                                                <label>C/O</label>
                                                                <input type="text" class="form-control" value="" id="co" name="co" asp-for="co" placeholder="" maxlength="40">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-6">
                                                            <div class="form-group">
                                                                <label>Email</label>
                                                                <input type="email" value="" class="form-control" id="email" asp-for="email" name="email" placeholder="Inserire Email" required maxlength="100">
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-6">
                                                            <div class="form-group">
                                                                <label>Posta Elettronica Certificata</label>
                                                                <input type="email" value="" class="form-control" id="pec" asp-for="pec" name="pec" placeholder="Inserire la PEC" title="Inserisci un dominio valido (&#64;pec o &#64;legalmail)" pattern="(.+)@("@")(legalmail|pec)(\.{1}([a-zA-Z0-9-])+)*" maxlength="100">

                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-6">
                                                            <div class="form-group">
                                                                <label>Telefono</label>
                                                                <input type="tel" value="" class="form-control" id="tel" asp-for="tel" name="tel" placeholder="Inserire Telefono" pattern="[0-9]{2}[0-9]{7}" maxlength="9">
                                                            </div>
                                                        </div>
                                                        <!-- <div class="col-sm-4">
                                                            <div class="form-group">
                                                                <label>Telefono 2</label>
                                                                <input type="tel" value="" class="form-control" id="tel2" asp-for="tel2" name="tel2" placeholder="Inserire Telefono2">
                                                            </div>
                                                        </div>-->
                                                        <div class="col-sm-6">
                                                            <div class="form-group">
                                                                <label>Cellulare</label>
                                                                <input type="tel" value="" class="form-control" pattern="[0-9]{3}[0-9]{7}" id="cell" asp-for="cell" name="cell" placeholder="Inserire Cellulare" required maxlength="10">
                                                            </div>
                                                        </div>

                                                    </div>

                                                    <div class="form-row justify-content-end mt-3">
                                                        <a class="btn btn-block btn-outline-success col-3" id="next1">
                                                            Avanti
                                                        </a>
                                                    </div>

                                                    <!--<div class="col-sm-4">
                                                        <div class="form-group">
                                                            <label>Fax</label>
                                                            <input type="tel" value="" class="form-control" id="fax" asp-for="fax" name="fax" placeholder="Inserire il Fax">
                                                        </div>
                                                    </div>-->

                                                    </div>
                                                </div>
                                                <div class="tab-pane fade" id="custom-tabs-one-profile" role="tabpanel" aria-labelledby="custom-tabs-one-profile-tab">
                                                    <div class="card-body">
                                                        <div class="row">
                                                            <div class="col-sm-3">
                                                                <div class="form-group">
                                                                    <label>Data iscrizione</label>
                                                                    <input type="date" value="" id="datIsc" name="datIsc" asp-for="datIsc" class="form-control" required>
                                                                </div>
                                                            </div>
                                                            <div class="col-sm-3">
                                                                <div class="form-group">
                                                                    <label>Data denuncia</label>
                                                                    <input type="text" value="@DateTime.Now.ToString("dd/MM/yyyy")" id="datDen" name="datDen" asp-for="datDen" class="form-control" readonly required>
                                                                </div>
                                                            </div>

                                                        </div>
                                                        @*<div class="row" id="alertDataIscrizione" style="display: none">
            <div class="alert alert-danger" role="alert">
                Occorre compilare la data di iscrizione!
            </div>
        </div>*@
                                                        <div class="row">
                                                            <div class="col-sm-4">
                                                                <div class="form-group">
                                                                    <label>Tipo rapporto</label>
                                                                    <select class="form-control" name="tipRap" asp-for="tipRap" id="tipRap" required>
                                                                        <option value="">Seleziona tipo rapporto</option>
                                                                        @foreach (var item in Model.listNuovoIscritto)
                                                                        {
                                                                            <option value="@item.tipRap">@item.dentipRap</option>

                                                                        }
                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <div class="col-sm-2">
                                                                <div class="form-group" style="display:none" name="periododll" id="periododll">
                                                                    <label>Durata mesi</label>
                                                                    <select class="form-control" name="periodo" asp-for="periodo" id="periodo">

                                                                        <option selected></option>
                                                                        <option>24</option>
                                                                        <option>36</option>
                                                                        <option>48</option>

                                                                    </select>

                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="form-group" style="display: none; padding-left: 7.5px;" name="" id="data_termine">
                                                                <label> Data Termine</label>
                                                                <input type="date" value="" id="datTerm" name="datTerm" asp-for="datTerm" class="form-control">
                                                            </div>
                                                            <div class="form-group" style="display: none; padding-left: 7.5px;" name="part_time" id="part_time">
                                                                <label>% Part-Time</label>
                                                                <input type="number" id="PercPT" name="PercPT" class="form-control" min="0" max="100" step=".01"/>
                                                            </div>
                                                        </div>
                                                        <div class="row" style="padding-left: 7.5px;">

                                                            <div class="form-group align-items-center" style="display: none; column-gap: 10px;" name="da_al" id="da_al">
                                                                <label>Da</label>
                                                                <input type="date" class="form-control" name="daal" id="daal" asp-for="daal" readonly />
                                                                <label>Al</label>
                                                                <input type="date" class="form-control" name="alal" id="alal" asp-for="alal" readonly />
                                                                <label>%</label>
                                                                <input type="number" class="form-control" name="perce1" id="perce1" asp-for="perce1" min="0" max="100" />

                                                            </div>
                                                        </div>
                                                        <div class="row" style="padding-left: 7.5px;">
                                                            <div class="form-group align-items-center" style="display: none; column-gap: 10px;" name="da_al1" id="da_al1">
                                                                <label>Da</label>
                                                                <input type="date" class="form-control" name="daal2" id="daal2" asp-for="daal2" readonly />
                                                                <label>Al</label>
                                                                <input type="date" class="form-control" name="alal2" id="alal2" asp-for="alal2" readonly />
                                                                <label>%</label><input type="number" class="form-control" name="perce2" id="perce2" asp-for="perce2" min="0" max="100" />
                                                            </div>
                                                        </div>
                                                        <div class="row" style="padding-left: 7.5px;">
                                                            <div class="form-group align-items-center" style="display: none; column-gap: 10px;" name="da_al2" id="da_al2">
                                                                <label>Da</label>
                                                                <input type="date" class="form-control" name="daal3" id="daal3" asp-for="daal3" readonly />
                                                                <label>Al</label>
                                                                <input type="date" class="form-control" name="alal3" id="alal3" asp-for="alal3" readonly />
                                                                <label>%</label>
                                                                <input type="number" class="form-control" name="perce3" id="perce3" asp-for="perce3" min="0" max="100" />

                                                            </div>
                                                            <div class="form-group spazioCheckMesi" style="display:none" name="mesi" id="mesi">
                                                                <input type="checkbox" name="MeseSel[]" value="1" />
                                                                <label>Gen</label>
                                                                <input type="checkbox" name="MeseSel[]" value="2" />
                                                                <label>Feb</label>
                                                                <input type="checkbox" name="MeseSel[]" value="3" />
                                                                <label>Mar</label>
                                                                <input type="checkbox" name="MeseSel[]" value="4" />
                                                                <label>Apr</label>
                                                                <input type="checkbox" name="MeseSel[]" value="5" />
                                                                <label>Mag</label>
                                                                <input type="checkbox" name="MeseSel[]" value="6" />
                                                                <label>Giu</label>
                                                                <input type="checkbox" name="MeseSel[]" value="7" />
                                                                <label>Lug</label>
                                                                <input type="checkbox" name="MeseSel[]" value="8" />
                                                                <label>Ago</label>
                                                                <input type="checkbox" name="MeseSel[]" value="9" />
                                                                <label>Set</label>
                                                                <input type="checkbox" name="MeseSel[]" value="10" />
                                                                <label>Ott</label>
                                                                <input type="checkbox" name="MeseSel[]" value="11" />
                                                                <label>Nov</label>
                                                                <input type="checkbox" name="MeseSel[]" value="12" />
                                                                <label>Dic</label>
                                                            </div>

                                                        </div>
                                                        <div class="row">
                                                            <div class="col-sm-6">
                                                                <div class="form-group">
                                                                    <label>Contratto</label>
                                                                    <select class="form-control" id="contratto" name="contratto" required>
                                                                        <option></option>

                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <div class="col-sm-4">
                                                                <div class="form-group">
                                                                    <label>Livello</label>
                                                                    <select class="form-control" id="livello" name="codlivello" required>
                                                                        <option></option>

                                                                    </select>
                                                                </div>
                                                                <input type="text" id="denLiv" name="denLivello" hidden />
                                                            </div>
                                                        </div>

                                                        <div class="row">
                                                            <div class="col-sm-4">
                                                                <div class="form-group">
                                                                    <label>Qualifica</label>
                                                                    <select class="form-control" id="qualifica" name="qualifica" value="qualifica" required>
                                                                        <option></option>
                                                                    </select>

                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-3">
                                                            <div class="form-group">
                                                                <label>Numero mensilità</label>
                                                                <input type="number" id="numMes" name="numMes" class="form-control" required maxlength="2">
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <div class="form-group">
                                                                <label>Mese corrispondente 14°</label>
                                                                <input type="number" id="m14" name="m14" asp-for="m14" class="form-control" placeholder="Inserire mese 14°" readonly maxlength="4">
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <div class="form-group">
                                                                <label>15°</label>
                                                                <input type="number" id="m15" name="m15" asp-for="m15" class="form-control" placeholder="Inserire mese 15°" readonly maxlength="4">
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <div class="form-group">
                                                                <label>16°</label>
                                                                <input type="number" id="m16" name="m16" asp-for="m16" class="form-control" placeholder="Inserire mese 16°" readonly maxlength="4" pattern="^[0-9]*$">
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-3" style="display:none">
                                                            <div class="form-group">
                                                                <input type="text" id="tipspe" name="tipspe" asp-for="tipspe" class="form-control">

                                                                    <input type="text" id="codloc" name="codloc" asp-for="codloc" class="form-control">

                                                                    <input type="text" id="denconnew" name="denconnew" asp-for="denconnew">

                                                                    <input type="text" id="tiprapval" name="tiprapval" asp-for="tiprapval">
                                                                    <input type="text" id="codlival" name="codlival" asp-for="codlival">
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="row">
                                                            <div class="col-sm-4">
                                                                <div class="form-group">
                                                                    <label>Aliquota contributiva</label>
                                                                    <select class="form-control" id="aliqCont" name="gruass" asp-for="aliqCont"  style="pointer-events: none;background: #E9ECEF;" required>
                                                                        <option></option>


                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <div class="col-sm-4">
                                                                <div class="form-group">
                                                                    <label>Valore aliquota</label>
                                                                    <input type="text" id="aliquota" name="aliquota" asp-for="aliquota" class="form-control" readonly required>
                                                                </div>
                                                            </div>
                                                            <div class="col-sm-4" style="text-align:center">
                                                                <div class="form-group">
                                                                    <label>Fap</label>
                                                                    <input type="checkbox" name="fap" id="fap" asp-for="fap" class="form-control" value="true" @(Model.modIsc.fap ? "checked=\"checked\"" : "") style="width: 6%; margin: auto; pointer-events:none" />
                                                                </div>
                                                            </div>

                                                        </div>
                                                        <div class="row">
                                                            <div class="col-sm-3">
                                                                <div class="form-group">
                                                                    <div class="icheck-success d-inline d-flex">
                                                                        <input type="checkbox" name="assistenzaCon" id="assistenzaCon" asp-for="assistenzaCon" value="" style="pointer-events:none"/>
                                                                        <label class="form-check-label" style="pointer-events:none">
                                                                            Assistenza contrattuale
                                                                        </label>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="form-row justify-content-between mt-3" style="column-gap : 10px">
                                                            <a class="btn btn-outline-success col-3" id="back2">
                                                                Indietro
                                                            </a>
                                                            <a class="btn btn-block btn-outline-success col-3" id="next2">
                                                                Avanti
                                                            </a>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="tab-pane fade" id="custom-tabs-one-messages" role="tabpanel" aria-labelledby="custom-tabs-one-messages-tab">
                                                    <div class="card-body">


                                                    <div class="row">
                                                        <div class="col-sm-3">
                                                            <div class="form-group">
                                                                <label>Emolumenti contrattuali (€)</label>
                                                                <input class="form-control" id="emolumenti" asp-for="emolumenti" name="emolumenti" placeholder="0,00" readonly>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-3">
                                                            <div class="form-group">
                                                                <label>Retribuzione dichiarata (€)</label>
                                                                <input class="form-control" id="retDic" asp-for="retDic" name="retDic" placeholder="0,00" readonly>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-3">
                                                            <div class="form-group">
                                                                <label>Scatti di anzianità</label>
                                                                <input type="number" class="form-control" id="scattiAnz" asp-for="scattiAnz" name="scattiAnz" min="0" value="0" max="99" pattern="\d*" maxlength="17">
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <div class="form-group">
                                                                <label>Ultimo</label>
                                                                <input class="form-control" id="dataUltSc" asp-for="dataUltSc" name="dataUltSc" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <div class="form-group">
                                                                <label>Prossimo</label>
                                                                <input class="form-control" id="prossimoSc" asp-for="prossimoSc" name="prossimoSc" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <div class="form-group">
                                                                <label>Importo €</label>
                                                                <input class="form-control" value="" id="importoSc" asp-for="importoSc" name="importoSc" placeholder="0,00" readonly>
                                                            </div>
                                                        </div>

                                                    </div>
                                                    <div class=" row">
                                                        <div class="col-sm-5">
                                                            <div class="form-group">
                                                                <label>Emolumenti extracontrattuali per n° mensilità:</label>
                                                                <br />
                                                                <label>12€</label>
                                                                <input type="text" class="form-control" value="" id="S12" asp-for="S12" name="S12" placeholder="0,00" maxlength="4">
                                                                <label>13€</label>
                                                                <input type="text" class="form-control" value="" id="S13" asp-for="S13" name="S13" placeholder="0,00" maxlength="4">
                                                                <label>14€</label>
                                                                <input type="text" class="form-control" value="" id="S14" asp-for="S14" name="S14" placeholder="0,00" maxlength="4">
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-5">
                                                            <div class="form-group">
                                                                <label style="height:17px"></label>
                                                                <br />
                                                                <label>15€</label>
                                                                <input type="text" class="form-control" value="" id="S15" asp-for="S15" name="S15" placeholder="0,00" readonly maxlength="4">
                                                                <label>16€</label>
                                                                <input type="text" class="form-control" value="" id="S16" asp-for="S16" name="S16" placeholder="0,00" readonly maxlength="4">
                                                                <label>Totale €</label>
                                                                <input type="text" class="form-control" value="" id="totaleS" asp-for="totaleS" name="totaleS" placeholder="Totale" readonly>
                                                            </div>
                                                        </div>
                                                    </div>

                                                        @if ((bool)TempData["isAziSomm"])
                                                        {
                                                            <div class="form-row justify-content-between mt-3" style="column-gap : 10px">
                                                                <a class="btn btn-outline-success col-3" id="back3">
                                                                    Indietro
                                                                </a>
                                                                <a class="btn btn-block btn-outline-success col-3" id="next3">
                                                                    Avanti
                                                                </a>
                                                            </div>
                                                        }
                                                        else
                                                        {
                                                            <div class="form-row justify-content-between mt-3" style="column-gap : 10px">
                                                                <a class="btn btn-block btn-outline-success col-3" id="back3">
                                                                    Indietro
                                                                </a>
                                                                <input type="submit" value="Salva" id="blocco" name="blocco" asp-for="blocco" class="btn btn-outline-success col-3">
                                                            </div>
                                                        }
                                                    </div>
                                                </div>
                                                @if ((bool)TempData["isAziSomm"])
                                                {

                                            <div class="tab-pane fade" id="custom-tabs-one-settings" role="tabpanel" aria-labelledby="custom-tabs-one-settings-tab">
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-sm-3">
                                                            <div class="form-group">
                                                                <label>Posizione</label>
                                                                <input type="text" class="form-control" id="pozioneAZ" asp-for="pozioneAZ" name="pozioneAZ" value="@modIsc.pozioneAZ" maxlength="10">
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <div class="form-group">
                                                                <label>Ragione sociale</label>
                                                                <input type="text" class="form-control" id="ragsocAZ" asp-for="ragsocAZ" name="ragsocAZ" value="@modIsc.ragsocAZ" required maxlength="100">
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <div class="form-group">
                                                                <label>Codice fiscale</label>
                                                                <input type="text" class="form-control" id="cfAz" asp-for="cfAz" name="cfAz" value="@modIsc.cfAz" required maxlength="16">
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <div class="form-group">
                                                                <label>Partita IVA</label>
                                                                <input type="text" class="form-control" id="piAZ" asp-for="piAZ" name="piAZ" value="@modIsc.piAZ" placeholder="Cerca azienda con p.Iva" required maxlength="11">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-3">
                                                            <div class="form-group">
                                                                <label>DUG</label>
                                                                <select class="form-control" id="DUG" name="residenzaAZCod" asp-for="residenzaAZ" required value="@modIsc.residenzaAZCod" title="Tipo di indirizzo non valido">
                                                                    <option value=""></option>
                                                                    @foreach (var std in ViewBag.ListaDug)
                                                                    {
                                                                        <option value="@std.CODDUG" @(modIsc.residenzaAZCod == std.CODDUG ? "selected" : "")>@std.DENDUG</option>
                                                                    }
                                                                </select>

                                                            </div>
                                                        </div>
                                                        <div class="col-sm-6">
                                                            <div class="form-group">
                                                                <label>Indirizzo di Residenza</label>
                                                                <input type="text" class="form-control" id="indirizzoAZ" asp-for="indirizzoAZ" name="indirizzoAZ" value="@modIsc.indirizzoAZ" required maxlength="80">
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <div class="form-group">
                                                                <label>Civico</label>
                                                                <input type="text" class="form-control" id="numCivAZ" asp-for="numCivAZ" name="numCivAZ" value="@modIsc.numCivAZ" required maxlength="10" pattern="^(^\d+(\/[a-zA-Z])?[a-zA-Z]?$)|(SNC)$">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-sm-3">
                                                            <div class="form-group">
                                                                <label>Provincia</label>
                                                                <select type="text" class="form-control" id="ProvinciaS" asp-for="provinciaAZ" name="provinciaAZ" value="@modIsc.provinciaAZ" required>
                                                                    <option value="">Selezionare la Provincia</option>
                                                                    @foreach (var prov in ViewBag.ListaProvince)
                                                                    {
                                                                        if (prov.SIGPRO != "EE")
                                                                        {
                                                                            <option value="@prov.SIGPRO" @(modIsc.provinciaAZ == prov.SIGPRO ? "selected" : "")>@prov.SIGPRO</option>
                                                                        }
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <div class="form-group">
                                                                <label>Comune</label>
                                                                <select type="text" class="form-control" id="ComuneS" asp-for="comuneAZCod" name="comuneAZCod" value="@modIsc.comuneAZ" required style="pointer-events: none;background: #E9ECEF;">
                                                                    <option value="">Selezionare Comune</option>
                                                                    @foreach (var std in ViewBag.ListaComuni)
                                                                    {
                                                                        <option value="@std.CODCOM" @(Model.modIsc.comuneAZ == std.DENCOM ? "selected" : "")>@std.DENCOM</option>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <div class="form-group">
                                                                <label>Località</label>
                                                                <select type="text" class="form-control" id="LocalitaS" asp-for="localitaAZ" name="localitaAZ" value="@modIsc.localitaAZ" required style="pointer-events: none;background: #E9ECEF;">
                                                                    <option value="">Selezionare la Località</option>
                                                                    @foreach (var loc in ViewBag.ListaLocalita)
                                                                    {
                                                                        <option value="@loc.DENLOC" @(modIsc.localitaAZ == loc.DENLOC ? "selected" : "")>@loc.DENLOC</option>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="col-sm-3">
                                                            <div class="form-group">
                                                                <label>CAP</label>
                                                                <input type="text" class="form-control" id="CAPS" asp-for="capAZ" name="capAZ" value="@modIsc.capAZ" readonly required maxlength="9">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="form-row justify-content-between mt-3" style="column-gap : 10px">
                                                        <a class="btn btn-block btn-outline-success col-3" id="back4">
                                                            Indietro
                                                        </a>
                                                        <input type="submit" value="Salva" id="blocco" name="blocco" asp-for="blocco" class="btn btn-outline-success col-3">
                                                    </div>
                                                </div>
                                            </div>
                                                }
                                            </div>
                                        <div class="mt-3 alert alert-success" role="alert">
                                            Per salvare i dati premere il tasto salva alla fine della procedura.
                                        </div>
                                        </div>
                                        <!-- /.card -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                }

            </div>
        </div>
    </div>
</section>
<script>

    function setAllInputTextFieldsToUpper() {
        let allInputsTypeText = document.querySelectorAll("input[type=text]");
        allInputsTypeText.forEach(
            (element) => element.oninput = function () {
                this.value = this.value.toUpperCase();
            });        
    }

    $(document).ready(function () {
        setAllInputTextFieldsToUpper();
    });

    $('#next1').click(function (e) {
        let checkFormValidity = document.getElementById('cognome').reportValidity()
            && document.getElementById('nome').reportValidity()
            && document.getElementById('codFis').reportValidity()
            && document.getElementById('dataNas').reportValidity()
            && document.getElementById('sesso').reportValidity()
            && document.getElementById('comuneN').reportValidity()
            && document.getElementById('provinciaN').reportValidity()
            && document.getElementById('statoEsN').reportValidity()
            && document.getElementById('titoloStudio').reportValidity()
            && document.getElementById('indirizzo').reportValidity()
            && document.getElementById('residenza').reportValidity()
            && document.getElementById('civico').reportValidity()
            && document.getElementById('provincia').reportValidity()
            && document.getElementById('comune').reportValidity()
            && document.getElementById('localita').reportValidity()
            && document.getElementById('cap').reportValidity()
            && document.getElementById('statoEs').reportValidity()
            && document.getElementById('email').reportValidity()
            && document.getElementById('cell').reportValidity();

        if (checkFormValidity)
            $('#custom-tabs-one-profile-tab').tab('show');
    });

    $('#back2').click(function () {
        $('#custom-tabs-one-home-tab').tab('show');
    });

    $('#next2').click(function (e) {
        let checkFormValidity = document.getElementById('datIsc').reportValidity()
            && document.getElementById('datDen').reportValidity()
            && document.getElementById('tipRap').reportValidity()
            && document.getElementById('periodo').reportValidity()
            && document.getElementById('datTerm').reportValidity()
            && document.getElementById('daal').reportValidity()
            && document.getElementById('daal2').reportValidity()
            && document.getElementById('daal3').reportValidity()
            && document.getElementById('alal').reportValidity()
            && document.getElementById('alal2').reportValidity()
            && document.getElementById('alal3').reportValidity()
            && document.getElementById('perce1').reportValidity()
            && document.getElementById('perce2').reportValidity()
            && document.getElementById('perce3').reportValidity()
            && document.getElementById('PercPT').reportValidity()
            && checkValiditaMesi()
            && document.getElementById('contratto').reportValidity()
            && document.getElementById('livello').reportValidity()
            && document.getElementById('qualifica').reportValidity()
            && document.getElementById('numMes').reportValidity()
            && document.getElementById('aliquota').reportValidity()
            && document.getElementById('aliqCont').reportValidity();
        if (checkFormValidity)
            $('#custom-tabs-one-messages-tab').tab('show');
    });

    $('#back3').click(function () {
        $('#custom-tabs-one-profile-tab').tab('show');
    });

    $('#next3').click(function (e) {
        $('#custom-tabs-one-settings-tab').tab('show');
    });

    $('#back4').click(function () {
        $('#custom-tabs-one-messages-tab').tab('show');
    });


    $("#ProvinciaS").change(function () {
        if ($(this).val() == '') {
            $("#ComuneS").html('');
            $("#LocalitaS").html('');
            $("#CAPS").val('');
            $("#ProvinciaS").val('');
            $("#LocalitaS").attr('style', 'pointer-events: none;background: #E9ECEF;');
            $("#ComuneS").attr('style', 'pointer-events: none;background: #E9ECEF;');
            return;
        }
        
        const uri = '@Url.Action("GetComune", "Iscritto")';
        const provincia = $(this).val();
        $.ajax({
            cache: false,
            url: uri,
            type: 'GET',
            data: { provincia: provincia },
            success: function (data) {
                debugger;
                var s = '<option value="">Selezionare Comune</option>';
                for (var i = 0; i < data.length; i++) {
                    s += '<option value="' + data[i].CODCOM + '">' + data[i].DENCOM + '</option>';
                }
                $("#ComuneS").html(s);
                $("#LocalitaS").val('');
                $("#ComuneS").attr('style', '');
                $("#CAPS").val('');
            },
            error: function (result) {

            }
        });
        
    });
    $("#ComuneS").change(function () {
        if ($(this).val() == '') {
            $("#LocalitaS").html('');
            $("#CAPS").val('');
            return;
        }

        const uri = '@Url.Action("GetLocalita", "Iscritto")';
        const comune = $(this).val();
        $.ajax({
            cache: false,
            url: uri,
            type: 'GET',
            data: { comune: comune },
            success: function (data) {
                debugger;
                var s = '<option value="">Selezionare la Località</option>';
                for (var i = 0; i < data.length; i++) {
                    s += '<option value="' + data[i].DENLOC + '">' + data[i].DENLOC + ' - ' + data[i].CAP + '</option>';
                }
                $("#LocalitaS").html(s);
                $("#LocalitaS").attr('style', '');
                $("#CAPS").val('');
            },
            error: function (result) {



            },
            complete: function () {
            },
        });
        
    });

    $("#LocalitaS").change(function () {
        if ($(this).val() == '') {
            $("#CAPS").val('');
            return;
        }

        const uri = '@Url.Action("GetCap", "Iscritto")';
        const LocalitaS = $(this).val();
        $.ajax({
            cache: false,
            url: uri,
            type: 'GET',
            data: { loc: LocalitaS },
            success: function (data) {
                const loc = $("select#localita>option:selected").text();
                const locArray = loc.split("-");
                if (locArray !== undefined && locArray.length == 2) {
                    const CAPS = locArray[1].trim();
                    indexCAPS = data.findIndex(x => x.CAP === CAPS);
                    indexCAPS > 0 ? $("#CAPS").val(data[indexCAPS].CAP) : $("#CAPS").val(data[0].CAP);
                }
                else
                    $("#CAPS").val(data[0].CAP);
            },
            error: function (result) {},
            complete: function () {},
        });

    });

    function CercaIscritto() {
        var codfis = $('#codiceFiscale').val().toUpperCase();

        $.ajax(
            {
                url: '@Url.Action("CercaIscritto", "AziendaConsulente")',
                data: { 'codfis': codfis },
                success: function (data) {
                    if (data.codFis == null) {
                        alert('Utente non trovato!');
                        return;
                    }

                    let comuneResidenza = getComuneResidenzaFrom(data.comune);
                    let genereDaInserire = getGenereFrom(data.sesso);
                    let statoEstero = getCodStatoEstFrom(data.statoEs.trim());

                    if (comuneResidenza)
                        setAndFillOptionsForSelectComuniLocalita(data.provincia, comuneResidenza);

                    fillFiedsWithDataFromAjax(data, genereDaInserire, comuneResidenza, statoEstero);
                    setAttributeToField();
                },
                error: function () {
                    alert('Errore');
                },
                complete: function () { }
            }
        );

        function getComuneResidenzaFrom(comuneFromData) {
            if (!comuneFromData)
                return;

            let comuneResidenza;
            for (let comune of listaComuni) {
                if (comune['DENCOM'].trim() == comuneFromData.trim()) {
                    comuneResidenza =
                    {
                        nomeComune: comune['DENCOM'].trim(),
                        codiceComune: comune['CODCOM']
                    };
                    break;
                }                        
            }

            return comuneResidenza;
        }

        function getGenereFrom(sesso) {
            let genere;
            sesso == 'M' ? genere = 1 : genere = 2;
            sesso == '1' ? genere = 1 : genere = 2;
            return genere;
        }

        function setAndFillOptionsForSelectComuniLocalita(provincia, comuneResidenza) {
            let localitaComuni = setSelectComuniLocalita(provincia, comuneResidenza);
            let listaComuniToShow = localitaComuni['comuni'];
            let listaLocalitaToShow = localitaComuni['localita'];

            fillOptionsSelectComuniAndLocalita(listaComuniToShow, listaLocalitaToShow);            

            function fillOptionsSelectComuniAndLocalita(listaComuniToShow, listaLocalitaToShow) {
                let s = '';
                for (let i = 0; i < listaComuniToShow.length; i++) {
                    s += '<option value="' + listaComuniToShow[i]['CODCOM'] + '">' + listaComuniToShow[i]['DENCOM'] + '</option>';
                }
                $("#comune").html(s);

                let x = '';
                for (let i = 0; i < listaLocalitaToShow.length; i++) {
                    x += '<option value="' + listaLocalitaToShow[i]['DENLOC'] + '">' + listaLocalitaToShow[i]['DENLOC'] + '</option>';
                }
                $("#localita").html(x);
            }
        }

        function getCodStatoEstFrom(denominazioneStatoEstero) {
            let codiceStatoEstero = '';
            for (let statoEstero of listaStatiEsteri)
                if (statoEstero['DENCOMSE'].trim() == denominazioneStatoEstero) {
                    codiceStatoEstero = statoEstero['CODCOMSE'];
                    break;
                }
            return codiceStatoEstero;
        }

        function fillFiedsWithDataFromAjax(data, genereDaInserire, comuneResidenza, statoEstero) {
            $('#codFis').attr("placeholder", data.codFis);
            $("#codFis").val(data.codFis);
            $("#matricola").val(data.matricola);
            $("#cognome").val(data.cognome);
            $("#nome").val(data.nome);
            $("#dataNas").val(data.dataNas);
            $("#sesso").val(genereDaInserire);
            $("#titoloStudio").val(data.titoloStudioCod);
            $("#indirizzo").val(data.indirizzoCod);
            $("#residenza").val(data.residenza);
            $("#civico").val(data.civico);
            $("#provincia").val(data.provincia);
            $("#cap").val(data.cap);
            $("#statoEs").val(statoEstero);
            $("#co").val(data.co);
            $("#tel").val(data.tel);
            $("#tel2").val(data.tel2);
            $("#cell").val(data.cell);
            $("#fax").val(data.fax);
            $("#email").val(data.email);
            $("#pec").val(data.pec);

            if (data.provinciaN.trim().toUpperCase() == 'EE') {
                $("#statoEsN").val(data.comuneNCod);
            }
            else {
                $("#comuneN").val(data.comuneNCod);
                $("#provinciaN").val(data.provinciaN);
                $("#statoEsN").val('');
                $("#statoEsN").html('');
            }

            if (statoEstero == null || statoEstero == "") {
                $("#comune").val(comuneResidenza['codiceComune']);
                $("#localita").val(data.localita);
            }
            else {
                $("#localita").attr('style', 'pointer-events: none;background: #E9ECEF;');
                $("#comune").attr('style', 'pointer-events: none;background: #E9ECEF;');
                $("#provincia").attr("required", false);
                $("#comune").attr("required", false);
                $("#localita").attr("required", false);
                $("#cap").attr("required", false);
            }
        }
    }

    function setAttributeToField() {
        $("#codFis").attr("readonly", true);
        $("#matricola").attr("readonly", true);
        $("#cognome").attr("readonly", true);
        $("#nome").attr("readonly", true);
        $("#dataNas").attr("readonly", true);
        $("#comuneN").attr("readonly", true);
        $("#comuneNCod").attr("readonly", true);
        $("#provinciaN").attr("readonly", true);
        $('#indirizzo').attr("readonly", false);
        $('#titoloStudio').attr("readonly", false);
        $('#sesso').attr("readonly", true);
        $("#residenza").attr("readonly", false);
        $("#civico").attr("readonly", false);
        $("#provincia").attr("readonly", false);
        $("#statoEsN").attr('style', 'pointer-events: none;background: #E9ECEF;');
        $("#statoEs").attr('style', '');
        $("#co").attr("readonly", false);
    }

</script>

<script>
    var emolumentiCompleti = 0;

    $("#tipRap").on('change', function () {
        removeAllRequiredFromTipoContratto();
        var $option = $(this).find('option:selected');
        var a = $option.val();
        if (a == 1) {
            $("#da_al").hide();
            $("#da_al1").hide();
            $("#da_al2").hide();
            $("#part_time").hide();
            $("#mesi").hide();
            $("#periododll").hide();
        }

        //A TERMINE
        if (a == 2) {
            $("#data_termine").show();
            $("#part_time").hide();
            $("#da_al").hide();
            $("#da_al1").hide();
            $("#da_al2").hide();
            $("#mesi").hide();
            $("#periododll").hide();
            $("#datTerm").attr("required",  'required');
        }

        //Part time
        if (a == 3) {
            $("#part_time").show();
            $("#data_termine").hide(); //????
            $("#da_al").hide();
            $("#da_al1").hide();
            $("#da_al2").hide();
            $("#mesi").hide();
            $("#periododll").hide();
            $("#PercPT").attr("required",  'required');
        }
        //Part time a termine
        if (a == 4) {
            $("#part_time").show();
            $("#data_termine").show();
            $("#da_al").hide();
            $("#da_al1").hide();
            $("#da_al2").hide();
            $("#mesi").hide();
            $("#periododll").hide();
            $("#PercPT").attr("required",  'required');
            $("#datTerm").attr("required",  'required');
        }

        if (a == 6) {
            $("#part_time").hide();
            $("#data_termine").hide();
            $("#da_al").css('display', 'flex');
            $("#da_al1").css('display', 'flex');
            $("#da_al2").css('display', 'flex');
            $("#mesi").hide();
            $("#periododll").show();
            if ($('#datIsc').val() != '')
                $('#daal').val($('#datIsc').val());

            $("#daal").attr("required",  'required');
            $("#daal2").attr("required",  'required');
            $("#daal3").attr("required",  'required');
            $("#alal").attr("required",  'required');
            $("#alal2").attr("required",  'required');
            $("#alal3").attr("required",  'required');
            $("#perce1").attr("required",  'required');
            $("#perce2").attr("required",  'required');
            $("#perce3").attr("required",  'required');
            $("#periodo").attr("required",  'required');
        }

        //APPRENDISTATO
        if (a == 7) {
            $("#part_time").hide();
            $("#data_termine").hide();
            $("#da_al").css('display', 'flex');
            $("#da_al1").css('display', 'flex');
            $("#da_al2").css('display', 'flex');
            $("#mesi").hide();
            $("#periododll").show();
            if ($('#datIsc').val() != '')
                $('#daal').val($('#datIsc').val());

            $("#daal").attr("required",  'required');
            $("#daal2").attr("required",  'required');
            $("#daal3").attr("required",  'required');
            $("#alal").attr("required",  'required');
            $("#alal2").attr("required",  'required');
            $("#alal3").attr("required",  'required');
            $("#perce1").attr("required",  'required');
            $("#perce2").attr("required",  'required');
            $("#perce3").attr("required",  'required');
            $("#periodo").attr("required",  'required');
        }

        if (a == 8) {
            $("#part_time").show();
            $("#data_termine").hide();
            $("#da_al").css('display', 'flex');
            $("#da_al1").css('display', 'flex');
            $("#da_al2").css('display', 'flex');
            $("#mesi").hide();
            $("#periododll").show();
            if ($('#datIsc').val() != '')
                $('#daal').val($('#datIsc').val());

            $("#daal").attr("required",  'required');
            $("#daal2").attr("required",  'required');
            $("#daal3").attr("required",  'required');
            $("#alal").attr("required",  'required');
            $("#alal2").attr("required",  'required');
            $("#alal3").attr("required",  'required');
            $("#perce1").attr("required",  'required');
            $("#perce2").attr("required",  'required');
            $("#perce3").attr("required",  'required');
            $("#PercPT").attr("required",  'required');
            $("#periodo").attr("required",  'required');
        }

        //Contratto di inserimento
        if (a == 9) {
            $("#data_termine").show();
            $("#da_al").hide();
            $("#da_al1").hide();
            $("#da_al2").hide();
            $("#mesi").hide();
            $("#part_time").hide();
            $("#periododll").hide();
            $("#datTerm").attr("required",  'required');
        }

        //Apprendistato %
        if (a == 10) {
            $("#part_time").show();
            $("#data_termine").hide();
            $("#da_al").css('display', 'flex');
            $("#da_al1").css('display', 'flex');
            $("#da_al2").css('display', 'flex');
            $("#mesi").hide();
            $("#periododll").show();
            if ($('#datIsc').val() != '')
                $('#daal').val($('#datIsc').val());

            $("#PercPT").attr("required",  'required');
            $("#daal").attr("required",  'required');
            $("#daal2").attr("required",  'required');
            $("#daal3").attr("required",  'required');
            $("#alal").attr("required",  'required');
            $("#alal2").attr("required",  'required');
            $("#alal3").attr("required",  'required');
            $("#perce1").attr("required",  'required');
            $("#perce2").attr("required",  'required');
            $("#perce3").attr("required",  'required');
            $("#periodo").attr("required",  'required');
        }

        if (a == 11) {
            $("#part_time").show();
            $("#mesi").show();
            $("#da_al").hide();
            $("#da_al1").hide();
            $("#da_al2").hide();
            $("#data_termine").hide();
            $("#periododll").hide();
            $("#PercPT").attr("required",  'required');
            setRequiredToMesi();
        }

        //Apprendistato professionalizzante
        if (a== 12) {
            $("#data_termine").show();
            $("#da_al").hide();
            $("#da_al1").hide();
            $("#da_al2").hide();
            $("#part_time").hide();
            $("#mesi").hide();
            $("#periododll").hide();
            $("#datTerm").attr("required",  'required');
        }

        if (a == 13) {
            $("#data_termine").show();
            $("#part_time").show();
            $("#da_al").hide();
            $("#da_al1").hide();
            $("#da_al2").hide();
            $("#mesi").hide();
            $("#periododll").hide();
            $("#datTerm").attr("required",  'required');
            $("#PercPT").attr("required",  'required');
        }

        if (a == 16) {
            $("#mesi").show();
            $("#data_termine").show();
            $("#da_al").hide();
            $("#da_al1").hide();
            $("#da_al2").hide();
            $("#part_time").hide();
            $("#periododll").hide();
            $("#datTerm").attr("required", 'required');
            setRequiredToMesi();
        }

        //Part time verticale
        if (a == 17) {
            $("#mesi").show();
            $("#data_termine").hide();
            $("#da_al").hide();
            $("#da_al1").hide();
            $("#da_al2").hide();
            $("#part_time").hide();
            $("#periododll").hide();
            setRequiredToMesi();
        }

        //19 smart warking part time
        if (a == 19) {
            $("#mesi").hide();
            $("#data_termine").hide();
            $("#da_al").hide();
            $("#da_al1").hide();
            $("#da_al2").hide();
            $("#part_time").show();
            $("#periododll").hide();
            $("#PercPT").attr("required",  'required');
        }

        //Apprendistato di alta formazione e ricerca %
        if (a == 21) {
            $("#mesi").hide();
            $("#data_termine").hide();
            $("#da_al").hide();
            $("#da_al1").hide();
            $("#da_al2").hide();
            $("#part_time").show();
            $("#periododll").hide();
            $("#PercPT").attr("required",  'required');
        }

        if (a == 1 || a == 14 || a == 15 || a == 18 || a == 20 || a == 5) {
            $("#mesi").hide();
            $("#data_termine").hide();
            $("#da_al").hide();
            $("#da_al1").hide();
            $("#da_al2").hide();
            $("#part_time").hide();
            $("#periododll").hide();
        }

    });

    $("#datIsc").on('change', function () {
        var datIni = $('#datIsc').val();
        var daal = $('#daal');

        var $option = $('#tipRap').find('option:selected');
        var a = $option.val();

        if (a == 6 || a == 7 || a == 8 || a == 10)
            daal.val(datIni);

        if ($('#periodo').val() != '') {
            setDaalPerFields();
        }
     $.ajax({

               url:'@Url.Action("DdlContratto", "AziendaConsulente")',
         data: { 'datIni': datIni },
              success: function (data) {
                  var s = '<option value=""></option>';
                  for (var i = 0; i < data.length; i++) {
                      s += '<option id="contratto" value="' + data[i].CODCON + '">' + data[i].DENCON + '</option>';
                      s += '<option id="procon" value="' + data[i].PROCON + '"hidden></option>';
                      s += '<option id="CODQUACON" value="' + data[i].CODQUACON + '"hidden></option>';

                    listaAssConContratti.push(
                        { 'CODCON': data[i].CODCON, 'ASSCON': data[i].ASSCON });
                  }
                  $("#contratto").html(s);
            },
            error: function ()
            {
                alert('Errore');
            },
            complete: function () {}
        })
    });

    $("#periodo").on('change', function () {

        if ($(this).val() == '') {
            $('#alal').val('');
            $('#daal2').val('');
            $('#alal2').val('');
            $('#daal3').val('');
            $('#alal3').val('');
            $('#perce1').val('');
            $('#perce2').val('');
            $('#perce3').val('');
            return;
        }
        if ($("#datIsc").val() == "") return;
        setDaalPerFields();
    });

    $('#contratto').on('change', function () {
        var $option = $(this).find('option:selected');
        var dencon = $option.text();
        var codcon = $option.val();
        let codPos = $('#codPos').val();
        
        if($(this).val() != ''){
            $.ajax({
                url: '@Url.Action("DdlLivello", "AziendaConsulente")',
                data: { 'codcon': codcon, 'dencon': dencon },
                success: function (datal) {
                    var s = '<option value=""></option>';
                    for (var i = 0; i < datal.length; i++) {
                        s += '<option value="' + datal[i].codliv + '">' + datal[i].denliv + '</option>';

                    }
                    $("#denconnew").val(dencon);
                    $("#livello").html(s);
                },
                error: function () {
                    alert('Errore');
                },
                complete: function () {
                    Mensilita(dencon);
                    Aliquote(dencon, codcon);
                    compilaAssConFrom(codcon);
                    checkFap(codPos, dencon);
                },
            });
        }
        else
        {
            resetFields();
        }

        function resetFields() {
            $('#livello').html('');
            $('#qualifica').html('');
            $('#numMes').val('');
            $("#m14").val('');
            $('#m14').prop('readonly', true)
            $("#m15").val('');
            $('#m15').prop('readonly', true)
            $("#m16").val('');
            $('#m16').prop('readonly', true)
            $("#fap").val(false);
            $("#fap").attr('checked', false);
            $("#aliqCont").html('');
            $("#aliquota").val('');
            $("#assistenzaCon").val(false);
            $("#assistenzaCon").attr('checked', false);
        }

        function compilaAssConFrom(codcon) {
            for (let contratto of listaAssConContratti) {
                let codConFromListaContratti = contratto['CODCON'];
                if (codConFromListaContratti != codcon)
                    continue;
                contratto['ASSCON'] == 'S' ? checkOrUncheck(true) : checkOrUncheck(false);
                break;
            }

            function checkOrUncheck(isAsscon) {
                if (isAsscon) {
                    $("#assistenzaCon").val(isAsscon);
                    $("#assistenzaCon").attr('checked', isAsscon);
                    $("#assistenzaCon").attr('style', 'pointer-events: none;background: #E9ECEF;');
                }
                else {
                    $("#assistenzaCon").val(isAsscon);
                    $("#assistenzaCon").attr('checked', isAsscon);
                    $("#assistenzaCon").attr('style', 'pointer-events: none;background: #E9ECEF;');
                }
            }
        }

        function checkFap(codPos, contrattoLavoro) {
            if (!isCodPosValidForFap(codPos) || !isContrattoLavoroValidForFap(contrattoLavoro.toUpperCase()))
                return;
            selectFap();

            function selectFap() {
                $("#fap").val(true);
                $("#fap").attr('checked', true);
            }

            function isCodPosValidForFap(codPos) {
                let isCodPosValidForFap = false;
                if (codPos == '40833' || codPos == '43656')
                    isCodPosValidForFap = true;
                return isCodPosValidForFap;
            }

            function isContrattoLavoroValidForFap(contrattoLavoro) {
                let isContrattoLavoroValidForFap = false;
                if (contrattoLavoro.includes('DIRIGENT'))
                    isContrattoLavoroValidForFap = true;
                return isContrattoLavoroValidForFap;
            }
        }

    });
    $('#livello').on('change', function () {
        $("#denLiv").val($("#livello option:selected").text().trim());
    })

    function Aliquote(dencon, codcon) {
        var dataNas = $('#dataNas').val();

             $.ajax({

                 url: '@Url.Action("DdlAliquota", "AziendaConsulente")',
                 data: { 'dataNas': dataNas, 'codcon': codcon, 'dencon': dencon },
                 success: function (datas) {
                     var s = '';
                    /* s += '<option id="denconnew" value="' + dencon + '" hidden></option>';*/
                     for (var i = 0; i < datas.length; i++)
                     {
                         s += '<option value="' + datas[i].CODGRUASS + '">' + datas[i].DENGRUASS + '</option>';

                     }
                     $("#aliqCont").html(s);
                     getValAliquota();
                 },
                 error: function () {
                     alert('Per determinare correttamente le aliquote inserire la data di nascita!');
                 },
                 complete: function () {

                 },

             });
    }

    function Mensilita(dencon) {

             $.ajax({

                 url: '@Url.Action("Mensilita", "AziendaConsulente")',
                 data: {  'dencon': dencon },
                 success: function (datam) {
                     s = '<option selected value="' + datam.qualifica + '">' + datam.qualifica + '</option>';
                     $("#qualifica").html(s);
                     $("#numMes").val(datam.mensilita);
                     $("#m14").val(datam.m14);
                     $("#m15").val(datam.m15);
                     $("#m16").val(datam.m16);
                     $("#tipspe").val(datam.tipspe);
                     $("#codloc").val(datam.codloc);
                     setNumMes(datam.mensilita)
                 },
                 error: function () {

                 },
                 complete: function () {

                 },

             });
    }

    $("#aliqCont").on('change', function () {
        getValAliquota();
    });

    function getValAliquota() {
        var $option = $("#aliqCont").find('option:selected');
        var CODGRUASS = $option.val();
        var dencon = $('#denconnew').val();
        var dataNas = $('#dataNas').val();
        var datIsc = $('#datIsc').val();
        var datMod = $('#datDen').val();
        var fap = $('#fap').is('checked');


     $.ajax({

         url: '@Url.Action("ValAliquota", "AziendaConsulente")',
         data: { 'CODGRUASS': CODGRUASS, 'dencon': dencon, 'datIsc': datIsc, 'datMod': datMod, 'dataNas': dataNas,'fap':fap },

         success: function (data)
         {
             $("#aliquota").val(data);

},
         error: function ()
         {
           alert('Errore');
         },
         complete: function ()
         {
         },
     })
        }

    $("#tipRap").on('change', function () {
        var $option = $(this).find('option:selected');
        var tiprap = $option.val();
        $('#tiprapval').val(tiprap);
        cleanFormField();
        $("#emolumenti").val(emolumentiCompleti);
        calcolaImportoTotale();
    });
    $("#livello").on('change', function () {
        var $option = $(this).find('option:selected');
        var codliv = $option.val();
        var dencon = $('#denconnew').val();
        var datMod = $('#datDen').val();
        $.ajax({

         url: '@Url.Action("Emolumenti", "AziendaConsulente")',
            data: { 'codliv': codliv, 'dencon': dencon,  'datMod': datMod},

         success: function (data)
         {
             let percPt = parseFloat($('#PercPT').val());
             let emolumenti = parseFloat(data.split(" ")[0].replace(".", "").replace(",", "."));
             emolumentiCompleti = emolumenti.toFixed(2);
             if (percPt) {
                 emolumenti = emolumenti * percPt / 100;
             }
             $("#emolumenti").val(emolumenti.toFixed(2));
             $('#codlival').val(codliv);
},
         error: function ()
         {
           alert('Errore');
         },
         complete: function ()
         {
             calcolaImportoTotale();
         },
     })
    });

    $("#numMes").on('keyup', function () {
        setNumMes($(this).val())
        setNumMesEmolumenti($(this).val())
    });
    function setNumMes(valore) {
        if (valore == '14') {
            $("#m14").prop("readonly", false);
            $("#m15").prop("readonly", true);
            $("#m16").prop("readonly", true);
        } else if (valore == '15') {
            $("#m14").prop("readonly", false);
            $("#m15").prop("readonly", false);
            $("#m16").prop("readonly", true);
        } else if (valore == '16') {
            $("#m14").prop("readonly", false);
            $("#m15").prop("readonly", false);
            $("#m16").prop("readonly", false);
        }
        else {
            $("#m14").prop("readonly", true);
            $("#m15").prop("readonly", true);
            $("#m16").prop("readonly", true);
        }
    }

    function setNumMesEmolumenti(valore) {
        if (valore == '14') {
            $("#S14").prop("readonly", false);
            $("#S15").prop("readonly", true);
            $("#S16").prop("readonly", true);
        } else if (valore == '15') {
            $("#S14").prop("readonly", false);
            $("#S15").prop("readonly", false);
            $("#S16").prop("readonly", true);
        } else if (valore == '16') {
            $("#S14").prop("readonly", false);
            $("#S15").prop("readonly", false);
            $("#S16").prop("readonly", false);
        }
        else {
            $("#S14").prop("readonly", true);
            $("#S15").prop("readonly", true);
            $("#S16").prop("readonly", true);
        }
    }

    $("#contratto").on('click', function () {
        if ($("#contratto").val() == "")
        {
            $("#alertDataIscrizione").show();
            setTimeout(function () {
                $("#alertDataIscrizione").hide(500);
            }, 5000);
        }
    });


    $("#scattiAnz").on('change', function () {


        var codliv = $("#livello").val();
        var datIsc = $('#datIsc').val();
        var datMod = $('#datDen').val();
        var numScatti = $('#scattiAnz').val();
        var dencon = $('#denconnew').val();
        var prorap = null;
        var tiprap = $('#tiprapval').val();

     $.ajax({

         url: '@Url.Action("SelLivello", "AziendaConsulente")',
         data: { 'numScatti': numScatti, 'dencon': dencon, 'codliv': codliv, 'datMod': datMod, 'datIsc': datIsc,'prorap':prorap,'tiprap':tiprap },

         success: function (data)
         {
             $("#importoSc").val(data);
             calcolaImportoTotale();
         },
         error: function ()
         {
             alert('Errore selezionare livello');
         },
         complete: function ()
         {
         },
     })
    });

    $("#PercPT").on('change', function () {
        let percPt = $("#PercPT").val();
        let emolumenti = parseFloat(emolumentiCompleti);
        if (percPt) {
            emolumenti = emolumenti * percPt / 100;
        }
        $("#emolumenti").val(emolumenti.toFixed(2));
    })

    $("#piAZ").on('keyup', function () {

        var piva = $('#piAZ').val();

            $.ajax({

                  url:'@Url.Action("CercaAziendaConPiva", "Amministrativo")',
                     data: { 'piva': piva },
                  success: function (data)
                  {
                      $("#ragsocAZ").val(data.ragsocAz);
                      $("#cfAz").val(data.codfisAz);
                      $("#pozioneAZ").val(data.codpos);
                      $("#LocalitaS").val(data.localitaAz);
                      $("#LocalitaS").html(`<option value="${data.localitaAz}" selected)>${data.localitaAz}</option>`);
                      $("#DUG").val(data.dugCodAz);
                      $("#indirizzoAZ").val(data.indirizzoAz);
                      $("#numCivAZ").val(data.civicoAz);
                      $("#ProvinciaS").val(data.provAz);
                      $("#CAPS").val(data.capAz);
                      $("#telefonoAZ").val(data.telefonoAz);
                      $("#ComuneS").val(data.comuneCodAz);
                      $("#ComuneS").html(`<option value="${data.comuneCodAz}" selected)>${data.comuneAz}</option>`);
                    },
                    error: function ()
                    {
                        $("#ragsocAZ").val('');
                        $("#cfAz").val('');
                        $("#pozioneAZ").val('');
                        $("#LocalitaS").val('');
                        $("#LocalitaS").html('');
                        $("#DUG").val('');
                        $("#indirizzoAZ").val('');
                        $("#numCivAZ").val('');
                        $("#ProvinciaS").val('');
                        $("#CAPS").val('');
                        $("#telefonoAZ").val('');
                        $("#ComuneS").val('');
                        $("#ComuneS").html('');
                    },
                    complete: function ()
                    {
                    }
              })
        });
    //CONTROLLO INPUT SOLO NUMERI SEGUITI DA VIRGOLA CON 2 DECIMALI
    function setInputFilter(textbox, inputFilter) {
        ["input", "keydown", "keyup", "mousedown", "mouseup", "select", "contextmenu", "drop"].forEach(function (event) {
            textbox.addEventListener(event, function () {
                if (inputFilter(this.value)) {
                    this.oldValue = this.value;
                    this.oldSelectionStart = this.selectionStart;
                    this.oldSelectionEnd = this.selectionEnd;
                } else if (this.hasOwnProperty("oldValue")) {
                    this.value = this.oldValue;
                    this.setSelectionRange(this.oldSelectionStart, this.oldSelectionEnd);
                } else {
                    this.value = "";
                }
            });
        });
    }

    setInputFilter(document.getElementById("S12"), function (value) {
        return /^-?\d*[,]?\d{0,2}$/.test(value);
    });
    setInputFilter(document.getElementById("S13"), function (value) {
        return /^-?\d*[,]?\d{0,2}$/.test(value);
    });
    setInputFilter(document.getElementById("S14"), function (value) {
        return /^-?\d*[,]?\d{0,2}$/.test(value);
    });

    $(document).on('change', function () {
        calcolaImportoTotale();
    });

    $("#provincia").change(function () {
        if ($(this).val() == '') {
            $("#comune").html('');
            $("#localita").html('');
            $("#cap").val('');
            $("#provincia").val('');
            $("#localita").attr('style', 'pointer-events: none;background: #E9ECEF;');
            $("#comune").attr('style', 'pointer-events: none;background: #E9ECEF;');
            return;
        }

        $("#statoEs").val("");
        const uri = '@Url.Action("GetComune", "Iscritto")';
        const provincia = $(this).val();
        $.ajax({
            cache: false,
            url: uri,
            type: 'GET',
            data: { provincia: provincia },
            success: function (data)
            {
                var s = '<option value="">Selezionare Comune</option>';
                for (var i = 0; i < data.length; i++) {
                    s += '<option value="' + data[i].CODCOM + '">' + data[i].DENCOM + '</option>';
                }
                $("#comune").html(s);
                $("#localita").html('');
                $('#cap').val('');
            },
            error: function (result) {}
        });

        if ($(this).val() != "" && $("#statoEs").val() == "") {
            $('#provincia').attr('style', '');
            $("#localita").attr('style', '');
            $("#comune").attr('style', '');
            $("#comune").attr("required", true);
            $("#localita").attr("required", true);
            $("#cap").attr("required", true);
            $("#provincia").attr("required", true);
            $("#statoEs").attr("required", false);

        }
    });

    $("#comune").change(function () {
        if ($(this).val() == '') {
            $("#localita").html('');
            $("#cap").val('');
            return;
        }

        const uri = '@Url.Action("GetLocalita", "Iscritto")';
        const comune = $(this).val();
        $.ajax({
            cache: false,
            url: uri,
            type: 'GET',
            data: { comune: comune },
            success: function (data) {
                var s = '<option value="">Selezionare la Località</option>';
                for (var i = 0; i < data.length; i++) {
                    s += '<option value="' + data[i].DENLOC + '">' + data[i].DENLOC + ' - ' + data[i].CAP +'</option>';
                }
                $("#localita").html(s);
                $('#cap').val('');
            },
            error: function (result) {}
        });

    });

    $("#localita").change(function () {
        if ($(this).val() == '') {
            $("#cap").val('');
            return;
        }

        const uri = '@Url.Action("GetCap", "Iscritto")';
        const LocalitaS = $(this).val();
        $.ajax({
            cache: false,
            url: uri,
            type: 'GET',
            data: { loc: LocalitaS },
            success: function (data) {
                const loc = $("select#localita>option:selected").text();
                const locArray = loc.split("-");
                if (locArray !== undefined && locArray.length == 2) {
                    const CAPS = locArray[1].trim();
                    indexCAPS = data.findIndex(x => x.CAP === CAPS);
                    if (indexCAPS > 0) {
                        $("#cap").val(data[indexCAPS].CAP);
                    }
                    else {
                        $("#cap").val(data[0].CAP);
                    }
                }
                else {
                    $("#cap").val(data[0].CAP);
                }
            },
            error: function (result) {},
            complete: function () {},
        });

    });

    $("#statoEs").change(function () {
        if ($(this).val() != "") {
            $("#comune").html('');
            $("#localita").html('');
            $("#cap").val('');
            $("#provincia").val('');
            $("#comune").attr("required", false);
            $("#localita").attr("required", false);
            $("#cap").attr("required", false);
            $("#provincia").attr("required", false);
            $("#statoEs").attr("required", true);
            $("#localita").attr('style', 'pointer-events: none;background: #E9ECEF;');
            $("#comune").attr('style', 'pointer-events: none;background: #E9ECEF;');
        }
        else {
            $("#localita").attr('style', '');
            $("#comune").attr('style', '');
            $("#comune").attr("required", true);
            $("#localita").attr("required", true);
            $("#cap").attr("required", true);
            $("#provincia").attr("required", true);
            $("#statoEs").attr("required", false);
        }
    });

    var listaAssConContratti = [];

</script>

<script>

    var listaComuni = @Html.Raw(JsonConvert.SerializeObject(ViewBag.ListaComuni));
    var listaGeneri = @Html.Raw(JsonConvert.SerializeObject(ViewBag.ListaGeneri));
    var listaStatiEsteri = @Html.Raw(JsonConvert.SerializeObject(ViewBag.ListaStatiEsteri));
    
    function checkAndCompilaFromCodFis() {
        let alertMsg;
        const nomeInserito = $("#nome").val().replace(/\s+/g, '').trim().toUpperCase();
        const cognomeInserito = $("#cognome").val().replace(/\s+/g, '').trim().toUpperCase();
        const codiceFiscaleInserito = $("#codFis").val().toUpperCase();
        const nomeFromCodFis = codiceFiscaleInserito.slice(0, 6);

        if (!codiceFiscaleInserito || !cognomeInserito || !nomeInserito)
            return;

        if (isCfModified(codiceFiscaleInserito))
            svuotaCampiCodFis();

        if (!controlloRequisitiCodiceFiscale(codiceFiscaleInserito, cognomeInserito, nomeInserito, nomeFromCodFis)) {
            alert(alertMsg);
            return;
        }

        compilaCampiFrom(codiceFiscaleInserito);

        function isCfModified(codiceFiscaleInserito) {
            let isCfModified = false;
            if (codiceFiscaleInserito)
                isCfModified = true;
            return isCfModified;
        }

        function svuotaCampiCodFis() {
            $('#dataNas').val('');
            $('#sesso').val('');
            $('#cognome').attr("readonly", false);
            $('#nome').attr("readonly", false);
            $('#statoEsN').val('');
            $('#statoEsN').html('');
            $('#comuneN').val('');
            $('#provinciaN').val('');
        }

        function controlloRequisitiCodiceFiscale(codiceFiscaleInserito, cognomeInserito, nomeInserito, nomeFromCodFis) {
            
            return sonoValidiNomeCognomeCf() && checkCongruenzaNomeCognomeConCodFis(nomeFromCodFis, nomeInserito, cognomeInserito)
                && isUltimaLetteraCfValid(codiceFiscaleInserito);

            function sonoValidiNomeCognomeCf() {
                let sonoValidi = false;
                if (document.getElementById('cognome').reportValidity() && document.getElementById('nome').reportValidity() && document.getElementById('codFis').reportValidity())
                    sonoValidi = true;
                if (!sonoValidi)
                    alertMsg = 'Codice fiscale inserito non valido';
                return sonoValidi;
            }

            function checkCongruenzaNomeCognomeConCodFis(nomeFromCodFis, nome, cognome) {
                let isTuttoCongruente = false;
                const cognomeDecostruito = getConsonantiAndVocali(cognome);
                const nomeDecostruito = getConsonantiAndVocali(nome);

                isTuttoCongruente = sonoCongruentiNomeCognome(
                    nomeFromCodFis, nomeDecostruito.consonanti, cognomeDecostruito.consonanti, nomeDecostruito.vocali, cognomeDecostruito.vocali);

                return isTuttoCongruente;

                function getConsonantiAndVocali(parola) {
                    let isConsonante = true;
                    const vocali = ['A', 'E', 'I', 'O', 'U', 'Y'];
                    let consonantiOfParola = [];
                    let vocaliOfParola = [];

                    for (let lettera of parola) {
                        for (let vocale of vocali) {
                            if (lettera == vocale) {
                                isConsonante = false;
                                vocaliOfParola.push(lettera);
                                break;
                            }
                        }
                        if (isConsonante)
                            consonantiOfParola.push(lettera);
                        isConsonante = true;
                    }

                    return {
                        consonanti: consonantiOfParola,
                        vocali: vocaliOfParola
                    };
                }

                function sonoCongruentiNomeCognome(nomeFromCodFis, consonantiOfNome, consonantiOfCognome, vocaliOfNome, vocaliOfCognome) {

                    const isCognomeCongruo = isCognomeCongruoWithCodiceFiscale();
                    if (!isCognomeCongruo)
                        alertMsg = 'Il cognome inserito non risulta congruente con il codice fiscale';

                    const isNomeCongruo = isNomeCongruoWithCodiceFiscale();
                    if (!isNomeCongruo)
                        alertMsg = 'Il nome inserito non risulta congruente con il codice fiscale';

                    if (!isCognomeCongruo && !isNomeCongruo)
                        alertMsg = 'Nome e cognome inseriti non congruenti con il codice fiscale';
                    
                    return isCognomeCongruo && isNomeCongruo;

                    function isCognomeCongruoWithCodiceFiscale() {
                        if (consonantiOfCognome.length >= 3) {
                            if (nomeFromCodFis[0] == consonantiOfCognome[0] && nomeFromCodFis[1] == consonantiOfCognome[1] && nomeFromCodFis[2] == consonantiOfCognome[2])
                                return true;
                        }
                        else if (consonantiOfCognome.length == 2) {
                            if (nomeFromCodFis[0] == consonantiOfCognome[0] && nomeFromCodFis[1] == consonantiOfCognome[1] && nomeFromCodFis[2] == vocaliOfCognome[0])
                                return true;
                        }
                        else if (consonantiOfCognome.length == 1) {
                            if (nomeFromCodFis[0] == consonantiOfCognome[0] && nomeFromCodFis[1] == vocaliOfCognome[0] && nomeFromCodFis[2] == vocaliOfCognome[1])
                                return true;
                        }
                        return false;
                    }

                    function isNomeCongruoWithCodiceFiscale() {
                        if (consonantiOfNome.length >= 4) {
                            if (nomeFromCodFis[3] == consonantiOfNome[0] && nomeFromCodFis[4] == consonantiOfNome[2] && nomeFromCodFis[5] == consonantiOfNome[3]) {
                                return true;
                            }
                        }
                        else if (consonantiOfNome.length == 3) {
                            if (nomeFromCodFis[3] == consonantiOfNome[0] && nomeFromCodFis[4] == consonantiOfNome[1] && nomeFromCodFis[5] == consonantiOfNome[2]) {
                                return true;
                            }
                        }
                        else if (consonantiOfNome.length == 2) {
                            if (nomeFromCodFis[3] == consonantiOfNome[0] && nomeFromCodFis[4] == consonantiOfNome[1] && nomeFromCodFis[5] == vocaliOfNome[0]) {
                                return true;
                            }
                        }
                        else if (consonantiOfNome.length == 1) {
                            if (nomeFromCodFis[3] == consonantiOfNome[0] && nomeFromCodFis[4] == vocaliOfNome[0] && nomeFromCodFis[5] == vocaliOfNome[1])
                                return true;
                        }
                        return false;
                    }
                }
            }

            function isUltimaLetteraCfValid(codiceFiscale) {
                const codiceFiscaleNoUltimaLettera = codiceFiscale.slice(0, 15);
                const ultimaLetteraCfInserito = codiceFiscale[15];
                const ultimaLetteraCalcolata = calcoloUltimaLetteraCf(codiceFiscaleNoUltimaLettera);
                const isUltimaLetteraValida = ultimaLetteraCalcolata == ultimaLetteraCfInserito;

                if (!isUltimaLetteraValida)
                    alertMsg = 'Ultima lettera del codice fiscale non valida';

                return isUltimaLetteraValida;

                function calcoloUltimaLetteraCf(codiceFiscaleNoUltimaLettera) {
                    let sommaLettere = 0;
                    let isEven = false;
                    for (let lettera of codiceFiscaleNoUltimaLettera) {
                        isEven ? sommaLettere += convertLettera(lettera, isEven) : sommaLettere += convertLettera(lettera, isEven);
                        isEven = !isEven;
                    }
                    return convertResto(sommaLettere % 26);

                    function convertLettera(lettera, isEven) {
                        let totaleNumeriLettere = caricaNumeriLettere();
                        let evenValues = caricaEvenValues();
                        let unevenValues = caricaUnevenValues();

                        return convertLetteraToValore(lettera, isEven, totaleNumeriLettere, evenValues, unevenValues)

                        function caricaNumeriLettere() {
                            return ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];
                        }

                        function caricaEvenValues() {
                            let evenValues = [];
                            let altroContatore = 0;
                            for (let i = 0; i < 36; i++) {
                                if (i >= 10) {
                                    evenValues.push(altroContatore)
                                    altroContatore++;
                                }
                                else
                                    evenValues.push(i);
                            }
                            return evenValues;
                        }

                        function caricaUnevenValues() {
                            return [1, 0, 5, 7, 9, 13, 15, 17, 19, 21, 1, 0, 5, 7, 9, 13, 15, 17, 19, 21, 2, 4, 18, 20, 11, 3, 6, 8, 12, 14, 16, 10, 22, 25, 24, 23];
                        }

                        function convertLetteraToValore(lettera, isEven, totaleNumeriLettere, evenValues, unevenValues) {
                            let valore = 0;
                            for (let i = 0; i < totaleNumeriLettere.length; i++)
                                if (totaleNumeriLettere[i] == lettera) {
                                    isEven ? valore = evenValues[i] : valore = unevenValues[i];
                                    break;
                                }
                            return valore;
                        }
                    }

                    function convertResto(resto) {
                        let letteraDaNumero;
                        let alfabeto = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];
                        for (let i = 0; i < 26; i++) {
                            if (resto == i) {
                                letteraDaNumero = alfabeto[i];
                                break;
                            }
                        }
                        return letteraDaNumero;
                    }
                }
            }
        }
        
        function compilaCampiFrom(codiceFiscaleInserito) {
            const annoNascita = getAnnoNascita(codiceFiscaleInserito[6] + codiceFiscaleInserito[7]);
            const meseNascita = getMeseNascita(codiceFiscaleInserito[8]);
            const giornoNascita = getGiornoNascita(codiceFiscaleInserito[9] + codiceFiscaleInserito[10]);
            const genere = getGenereFrom(codiceFiscaleInserito);

            if (isCittadinoEstero(codiceFiscaleInserito[11])) {
                const codiceStatoEstero = codiceFiscaleInserito[11] + codiceFiscaleInserito[12] + codiceFiscaleInserito[13] + codiceFiscaleInserito[14];
                const denominazioneStatoEstero = getDenominazioneStatoEstero(codiceStatoEstero);

                if (denominazioneStatoEstero)
                    compilaStatoEstero(codiceStatoEstero, denominazioneStatoEstero);
                else
                    return;
            }
            else {
                const codiceComune = codiceFiscaleInserito[11] + codiceFiscaleInserito[12] + codiceFiscaleInserito[13] + codiceFiscaleInserito[14];
                const codiceProvinciaFromCodiceComune = getCodiceProvinciaFromCodiceComune(codiceComune);

                if (codiceProvinciaFromCodiceComune)
                    compilaCampiComuneProvincia(codiceComune, codiceProvinciaFromCodiceComune);
                else
                    return;
            }

            completaCompilazioneCampiFromCodFis(annoNascita, meseNascita, giornoNascita, genere);

            function getAnnoNascita(numero) {
                let annoNascita = '';
                if (numero <= 10)
                    annoNascita += '20' + numero;
                else
                    annoNascita += '19' + numero;
                return annoNascita;
            }

            function getMeseNascita(lettera) {
                switch (lettera) {
                    case 'A': return '01';
                    case 'B': return '02';
                    case 'C': return '03';
                    case 'D': return '04';
                    case 'E': return '05';
                    case 'H': return '06';
                    case 'L': return '07';
                    case 'M': return '08';
                    case 'P': return '09';
                    case 'R': return '10';
                    case 'S': return '11';
                    case 'T': return '12';
                    default: return '';
                }
            }

            function getGiornoNascita(numero) {
                let giornoNascita = parseInt(numero);
                if (giornoNascita >= 40)
                    giornoNascita -= 40;
                if (giornoNascita < 10)
                    giornoNascita = '0' + giornoNascita;
                return giornoNascita;
            }

            function getGenereFrom(codiceFiscaleInserito) {
                let genere;
                parseInt(codiceFiscaleInserito[9] + codiceFiscaleInserito[10]) >= 40 ? genere = 2 : genere = 1;
                return genere;
            }

            function isCittadinoEstero(lettera) {
                let isEstero = false;
                if (lettera == 'Z')
                    isEstero = true;
                return isEstero;
            }

            function getDenominazioneStatoEstero(codiceStatoEstero) {
                let denominazioneStatoEstero;
                for (let statoEstero of listaStatiEsteri) {
                    if (statoEstero['CODCOMSE'] == codiceStatoEstero) {
                        denominazioneStatoEstero = statoEstero['DENCOMSE'].trim();
                        break;
                    }
                }
                return denominazioneStatoEstero;
            }

            function compilaStatoEstero(codiceStatoEstero, denominazioneStatoEstero) {
                $('#statoEsN').val(codiceStatoEstero);
                $('#statoEsN').html('<option value="' + codiceStatoEstero + '">' + denominazioneStatoEstero + '</option>');
                $('#statoEsN').attr('style', 'pointer-events: none;background: #E9ECEF;');
                $('#comuneN').val('');
                $('#comuneN').attr('style', 'pointer-events: none;background: #E9ECEF;');
                $('#provinciaN').val('');
                $('#provinciaN').attr('style', 'pointer-events: none;background: #E9ECEF;');
                $("#comuneN").attr("required", false);
                $("#provinciaN").attr("required", false);
                $("#statoEsN").attr("required", true);
            }

            function getCodiceProvinciaFromCodiceComune(codiceComune) {
                let codiceProvinciaFromCodiceComune;
                for (let comune of listaComuni) {
                    if (comune['CODCOM'] == codiceComune) {
                        codiceProvinciaFromCodiceComune = comune['SIGPRO'];
                        break;
                    }
                }
                return codiceProvinciaFromCodiceComune;
            }

            function compilaCampiComuneProvincia(codiceComune, codiceProvinciaFromCodiceComune) {
                $('#comuneN').val(codiceComune);
                $('#comuneN').attr('style', 'pointer-events: none;background: #E9ECEF;');
                $('#provinciaN').val(codiceProvinciaFromCodiceComune);
                $('#provinciaN').attr('style', 'pointer-events: none;background: #E9ECEF;');
                $('#statoEsN').attr('placeholder', '');
                $('#statoEsN').attr('style', 'pointer-events: none;background: #E9ECEF;');
                $("#comuneN").attr("required", true);
                $("#provinciaN").attr("required", true);
                $("#statoEsN").attr("required", false);
            }

            function completaCompilazioneCampiFromCodFis(annoNascita, meseNascita, giornoNascita, genere) {
                $('#dataNas').val(annoNascita + '-' + meseNascita + '-' + giornoNascita);
                $('#dataNas').attr('style', 'pointer-events: none;background: #E9ECEF;');
                $('#sesso').val(genere);
                $('#sesso').attr('style', 'pointer-events: none;background: #E9ECEF;');
                $('#cognome').attr("readonly", true);
                $('#nome').attr("readonly", true);
            }
        }
    }

</script>

<script>
    function cleanFormField() {
        var $option = $('#tipRap').find('option:selected');
        var a = $option.val();
        var datIni = $('#datIsc').val();
        $("#periodo").val('');
        $("#datTerm").val('');
        $("#daal").val('');
        $("#daal2").val('');
        $("#daal3").val('');
        $("#alal").val('');
        $("#alal2").val('');
        $("#alal3").val('');
        $("#perce1").val('');
        $("#perce2").val('');
        $("#perce3").val('');
        $("#mesi").val('');
        $("#PercPT").val('');

        if (a == 6 || a == 7 || a == 8 || a == 10)
            $("#daal").val(datIni);

        var divMesi = document.getElementById("mesi");
        var checkboxes = divMesi.querySelectorAll('input[type="checkbox"]');
        for (var i = 0; i < checkboxes.length; i++) {
            checkboxes[i].checked = false;
        }
    }

    function setDaalPerFields() {
        $('#daal').val($("#datIsc").val());
        var mesi = $('#periodo').val() / 3;
        var data1 = new Date($("#datIsc").val());
        var data2 = new Date(data1);
        var data2 = new Date(data2.setMonth(data2.getMonth() + mesi));
        var data3 = new Date(data2);
        data2.setDate(data2.getDate() - 1);
        var data4 = new Date(data3);
        data4 = new Date(data4.setMonth(data4.getMonth() + mesi));
        var data5 = new Date(data4);
        data4.setDate(data4.getDate() - 1);
        var data6 = new Date(data5);
        data6 = new Date(data6.setMonth(data6.getMonth() + mesi));
        data6.setDate(data6.getDate() - 1);

        var d3 = data3.getFullYear() + '-' + (+data3.getMonth() + 1).toString().padStart(2, '0') + '-' + data3.getDate().toString().padStart(2, '0');
        var d2 = data2.getFullYear() + '-' + (+data2.getMonth() + 1).toString().padStart(2, '0') + '-' + data2.getDate().toString().padStart(2, '0');
        var d4 = data4.getFullYear() + '-' + (+data4.getMonth() + 1).toString().padStart(2, '0') + '-' + data4.getDate().toString().padStart(2, '0');
        var d5 = data5.getFullYear() + '-' + (+data5.getMonth() + 1).toString().padStart(2, '0') + '-' + data5.getDate().toString().padStart(2, '0');
        var d6 = data6.getFullYear() + '-' + (+data6.getMonth() + 1).toString().padStart(2, '0') + '-' + data6.getDate().toString().padStart(2, '0');

        $("#alal").val(d2);
        $("#daal2").val(d3);
        $("#alal2").val(d4);
        $("#daal3").val(d5);
        $("#alal3").val(d6);

        $('#perce1').val('70');
        $('#perce2').val('80');
        $('#perce3').val('90');
    }

    function removeAllRequiredFromTipoContratto() {
        $("#periodo").attr("required", false);
        $("#datTerm").attr("required", false);
        $("#daal").attr("required", false);
        $("#daal2").attr("required", false);
        $("#daal3").attr("required", false);
        $("#alal").attr("required", false);
        $("#alal2").attr("required", false);
        $("#alal3").attr("required", false);
        $("#perce1").attr("required", false);
        $("#perce2").attr("required", false);
        $("#perce3").attr("required", false);
        $("#PercPT").attr("required", false);
        removeRequiredFromMesi();
    }


    $("#mesi input[type='checkbox']").change(function () {
        checkRequiredToMesi();
    });

    function checkRequiredToMesi(){
        var divMesi = document.getElementById("mesi");
        var checkboxes = divMesi.querySelectorAll('input[type="checkbox"]');
        for (var i = 0; i < checkboxes.length; i++) {
            if (checkboxes[i].checked) {
                removeRequiredFromMesi();
                return;
            }
        }
        setRequiredToMesi();
    }

    function removeRequiredFromMesi(){
        var divMesi = document.getElementById("mesi");
        var checkboxes = divMesi.querySelectorAll('input[type="checkbox"]');
        for (var i = 0; i < checkboxes.length; i++) {
            checkboxes[i].removeAttribute("required");
        }
    }

    function setRequiredToMesi() {
        var divMesi = document.getElementById("mesi");
        var checkboxes = divMesi.querySelectorAll('input[type="checkbox"]');
        for (var i = 0; i < checkboxes.length; i++) {
            checkboxes[i].setAttribute("required", 'required');
        }
    }

    function checkValiditaMesi(){
        var divMesi = document.getElementById("mesi");
        var checkboxes = divMesi.querySelectorAll('input[type="checkbox"]');
        for (var i = 0; i < checkboxes.length; i++) {
            if (checkboxes[i].checked) {
                return true;
            }
        }
        return checkboxes[0].reportValidity();
    }

    function calcolaImportoTotale(){
        var a = (parseFloat($('#emolumenti').val() || 0.00).toFixed(2));
        var b = (parseFloat($('#retDic').val().replace(",", ".") || 0.00).toFixed(2));
        var c = (parseFloat($('#importoSc').val().replace(",", ".") || 0.00).toFixed(2));
        var d = (parseFloat($('#S12').val().replace(",", ".") || 0.00).toFixed(2));
        var e = (parseFloat($('#S13').val().replace(",", ".") || 0.00).toFixed(2));
        var f = (parseFloat($('#S14').val().replace(",", ".") || 0.00).toFixed(2));
        var g = (parseFloat($('#S15').val().replace(",", ".") || 0.00).toFixed(2));
        var h = (parseFloat($('#S16').val().replace(",", ".") || 0.00).toFixed(2));

        var sum = 0;
        sum = parseFloat(a) + parseFloat(b) + parseFloat(c) + parseFloat(d) + parseFloat(e) + parseFloat(f) + parseFloat(g) + parseFloat(h);
        var totale = sum.toFixed(2).toString().replace(".", ",")
        $('#emolumenti').val($('#emolumenti').val().replace(".", ","))
        $("#totaleS").val(totale);
    }

</script>

<script>
    var listaLocalita = @Html.Raw(JsonConvert.SerializeObject(ViewBag.ListaLocalita));

    function setSelectComuniLocalita(sigPro,comune) {
        let listaComuni = getComuniFrom(sigPro);
        let listaLocalitaToShow = getLocalitaFrom(comune);

        return { 'comuni': listaComuni, 'localita': listaLocalitaToShow };
    }

    function getComuniFrom(sigPro) {
        let listOfComuniToShow = [];
        for (let comune of listaComuni) {
            if (comune['SIGPRO'] == sigPro) {
                listOfComuniToShow.push(comune);
            }
        }
        return listOfComuniToShow;
    }

    function getLocalitaFrom(comune) {
        let listaLocalitaToShow = []

        for (let localita of listaLocalita) {
            if (localita['CODCOM'] == comune['codiceComune'])
                listaLocalitaToShow.push(localita);
        }
        return listaLocalitaToShow;
    }

</script>
